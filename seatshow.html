<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>座席ビューア（拡張ズーム版）</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    canvas { border: 1px solid #ccc; margin-top: 20px; max-width: 100%; }
    #output { margin-top: 20px; background: #f7f7f7; padding: 10px; border: 1px solid #ccc; text-align: left; max-width: 600px; margin: auto; }
    #minimap { position: absolute; top: 20px; right: 20px; border: 1px solid #999; width: 300px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>座席ビューア（拡張ズーム版）</h1>
  <p>学籍番号を入力して、座席とグループを確認してください。</p>
  <input type="text" id="studentId" placeholder="学籍番号" />
  <button onclick="highlightGroup()">表示</button>

  <canvas id="seatCanvas"></canvas>
  <div id="output"></div>
  <canvas id="minimap" title="クリックで拡大/全体を切り替え"></canvas>

  <script>
    const canvas = document.getElementById("seatCanvas");
    const ctx = canvas.getContext("2d");
    const minimap = document.getElementById("minimap");
    const mctx = minimap.getContext("2d");
    const output = document.getElementById("output");
    const image = new Image(); image.src = "seatmap.png.jpg";

    // 設定
    const zoomSize = 400;
    const zoomScale = 2;
    let seatData = {
  "A": [
    {
      "start": 5,
      "count": 3,
      "x": 1200,
      "y": 1961,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1200,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 3,
      "x": 1200,
      "y": 749,
      "dy": 45.4
    }
  ],
  "B": [
    {
      "start": 5,
      "count": 3,
      "x": 1251,
      "y": 1961,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1251,
      "y": 1753,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 3,
      "x": 1251,
      "y": 748,
      "dy": 45.4
    }
  ],
  "C": [
    {
      "start": 4,
      "count": 4,
      "x": 1304,
      "y": 2008,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1304,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 4,
      "x": 1304,
      "y": 752,
      "dy": 45.4
    }
  ],
  "D": [
    {
      "start": 4,
      "count": 4,
      "x": 1355,
      "y": 2006,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1355,
      "y": 1755,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 4,
      "x": 1355,
      "y": 753,
      "dy": 45.4
    }
  ],
  "E": [
    {
      "start": 4,
      "count": 4,
      "x": 1406,
      "y": 2007,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1406,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 4,
      "x": 1406,
      "y": 753,
      "dy": 45.4
    }
  ],
  "F": [
    {
      "start": 3,
      "count": 5,
      "x": 1457,
      "y": 2051,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1457,
      "y": 1754,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 5,
      "x": 1457,
      "y": 750,
      "dy": 45.4
    }
  ],
  "G": [
    {
      "start": 3,
      "count": 5,
      "x": 1511,
      "y": 2053,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1511,
      "y": 1733,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 5,
      "x": 1511,
      "y": 747,
      "dy": 45.4
    }
  ],
  "H": [
    {
      "start": 2,
      "count": 6,
      "x": 1564,
      "y": 2099,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1562,
      "y": 1753,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 6,
      "x": 1562,
      "y": 750,
      "dy": 45.4
    }
  ],
  "I": [
    {
      "start": 1,
      "count": 7,
      "x": 1613,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1613,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1613,
      "y": 750,
      "dy": 45.4
    }
  ],
  "J": [
    {
      "start": 1,
      "count": 7,
      "x": 1666,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1666,
      "y": 1752,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1666,
      "y": 751,
      "dy": 45.4
    }
  ],
  "K": [
    {
      "start": 1,
      "count": 7,
      "x": 1720,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 1720,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1717,
      "y": 750,
      "dy": 45.4
    }
  ],
  "L": [
    {
      "start": 1,
      "count": 7,
      "x": 1771,
      "y": 2142,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1771,
      "y": 750,
      "dy": 45.4
    }
  ],
  "M": [
    {
      "start": 1,
      "count": 7,
      "x": 1824,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1824,
      "y": 751,
      "dy": 45.4
    }
  ],
  "N": [
    {
      "start": 1,
      "count": 7,
      "x": 1875,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 1875,
      "y": 1767,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 1873,
      "y": 1056,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1875,
      "y": 750,
      "dy": 45.4
    }
  ],
  "O": [
    {
      "start": 1,
      "count": 7,
      "x": 1928,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 1924,
      "y": 1790,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 1926,
      "y": 1079,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1924,
      "y": 750,
      "dy": 45.4
    }
  ],
  "P": [
    {
      "start": 1,
      "count": 7,
      "x": 1977,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 1977,
      "y": 1769,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 1977,
      "y": 1059,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 1977,
      "y": 750,
      "dy": 45.4
    }
  ],
  "Q": [
    {
      "start": 1,
      "count": 7,
      "x": 2030,
      "y": 2145,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 2030,
      "y": 1789,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 2030,
      "y": 1079,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2030,
      "y": 751,
      "dy": 45.4
    }
  ],
  "R": [
    {
      "start": 1,
      "count": 7,
      "x": 2084,
      "y": 2145,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 2081,
      "y": 1769,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 2079,
      "y": 1057,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2081,
      "y": 752,
      "dy": 45.4
    }
  ],
  "S": [
    {
      "start": 1,
      "count": 7,
      "x": 2135,
      "y": 2145,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 2132,
      "y": 1793,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 2132,
      "y": 1080,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2132,
      "y": 752,
      "dy": 45.4
    }
  ],
  "T": [
    {
      "start": 1,
      "count": 7,
      "x": 2186,
      "y": 2144,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 6,
      "x": 2186,
      "y": 1771,
      "dy": 45.4
    },
    {
      "start": 22,
      "count": 6,
      "x": 2186,
      "y": 1059,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2186,
      "y": 751,
      "dy": 45.4
    }
  ],
  "U": [
    {
      "start": 1,
      "count": 7,
      "x": 2298,
      "y": 2144,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2298,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2295,
      "y": 747,
      "dy": 45.4
    }
  ],
  "V": [
    {
      "start": 1,
      "count": 7,
      "x": 2349,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2349,
      "y": 1753,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2349,
      "y": 753,
      "dy": 45.4
    }
  ],
  "W": [
    {
      "start": 1,
      "count": 7,
      "x": 2402,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2400,
      "y": 1731,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2400,
      "y": 750,
      "dy": 45.4
    }
  ],
  "X": [
    {
      "start": 1,
      "count": 7,
      "x": 2451,
      "y": 2145,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2451,
      "y": 1753,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2451,
      "y": 750,
      "dy": 45.4
    }
  ],
  "Y": [
    {
      "start": 1,
      "count": 7,
      "x": 2506,
      "y": 2142,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2504,
      "y": 1731,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2502,
      "y": 748,
      "dy": 45.4
    }
  ],
  "Z": [
    {
      "start": 1,
      "count": 7,
      "x": 2555,
      "y": 2140,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2555,
      "y": 1752,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2555,
      "y": 748,
      "dy": 45.4
    }
  ],
  "AA": [
    {
      "start": 1,
      "count": 7,
      "x": 2608,
      "y": 2142,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2608,
      "y": 1730,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2608,
      "y": 749,
      "dy": 45.4
    }
  ],
  "AB": [
    {
      "start": 1,
      "count": 7,
      "x": 2659,
      "y": 2146,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2659,
      "y": 1753,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2659,
      "y": 748,
      "dy": 45.4
    }
  ],
  "AC": [
    {
      "start": 1,
      "count": 7,
      "x": 2713,
      "y": 2145,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2710,
      "y": 1731,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2710,
      "y": 750,
      "dy": 45.4
    }
  ],
  "AD": [
    {
      "start": 1,
      "count": 7,
      "x": 2764,
      "y": 2143,
      "dy": 45.4
    },
    {
      "start": 8,
      "count": 20,
      "x": 2764,
      "y": 1755,
      "dy": 45.4
    },
    {
      "start": 28,
      "count": 7,
      "x": 2764,
      "y": 750,
      "dy": 45.4
    }
  ]
};
    let studentToSeat = { "123456":"A08", "123457":"A09", "123458":"B10" };
    let groups = [["123456","123457","123458"]];

    let highlightBox = null;
    let zoomedIn = true;
    let fullImageLoaded = false;
    let currentSeat = null;
    let currentGroup = [];

    image.onload = () => {
      fullImageLoaded = true;
      minimap.width = 300;
      minimap.height = image.height / image.width * minimap.width;
      drawSeats();
    };

    minimap.addEventListener("click", () => {
      zoomedIn = !zoomedIn;
      drawSeats(currentSeat, currentGroup);
    });

    // 指定座席の座標を探す
    function findHighlightBox(mySeat) {
      if (!mySeat) return null;
      for (const col in seatData) {
        for (const seg of seatData[col]) {
          for (let i = 0; i < seg.count; i++) {
            const label = `${col}${String(seg.start + i).padStart(2,'0')}`;
            if (label === mySeat) {
              return { x: seg.x, y: seg.y - seg.dy * i };
            }
          }
        }
      }
      return null;
    }

    function drawSeats(mySeat = null, groupSeats = []) {
      if (!fullImageLoaded) return;
      highlightBox = findHighlightBox(mySeat);
      const scale = (zoomedIn && highlightBox) ? zoomScale : 1;

      // 背景描画
      if (zoomedIn && highlightBox) {
        const sx = Math.max(0, highlightBox.x - zoomSize/2);
        const sy = Math.max(0, highlightBox.y - zoomSize/2);
        canvas.width = zoomSize * zoomScale;
        canvas.height = zoomSize * zoomScale;
        ctx.drawImage(image, sx, sy, zoomSize, zoomSize, 0, 0, canvas.width, canvas.height);
      } else {
        canvas.width = image.width;
        canvas.height = image.height;
        ctx.drawImage(image, 0, 0);
      }

      // 座席描画
      for (const col in seatData) {
        for (const seg of seatData[col]) {
          for (let i = 0; i < seg.count; i++) {
            const label = `${col}${String(seg.start + i).padStart(2,'0')}`;
            let x = seg.x;
            let y = seg.y - seg.dy * i;
            if (zoomedIn && highlightBox) {
              x = (x - highlightBox.x + zoomSize/2) * zoomScale;
              y = (y - highlightBox.y + zoomSize/2) * zoomScale;
            }
            ctx.beginPath();
            ctx.arc(x, y, 20 * scale, 0, Math.PI*2);
            ctx.fillStyle = (label === mySeat) ? 'rgba(0,0,255,0.3)' : (groupSeats.includes(label) ? 'rgba(0,255,0,0.3)' : 'rgba(255,0,0,0.3)');
            ctx.fill();
            //if (label === mySeat) { ctx.strokeStyle='black'; ctx.lineWidth=2*scale; ctx.stroke(); }
            //ctx.fillStyle='black';
            //ctx.font=`${10*scale}px sans-serif`;
            //ctx.fillText(label, x + 10*scale, y + 3*scale);
          }
        }
      }

      // ミニマップ描画
      mctx.clearRect(0,0,minimap.width,minimap.height);
      mctx.drawImage(image, 0, 0, minimap.width, minimap.height);
      if (highlightBox) {
        const s = minimap.width / image.width;
        mctx.strokeStyle='gold'; mctx.lineWidth=2;
        mctx.strokeRect((highlightBox.x - zoomSize / 2) * s, (highlightBox.y - zoomSize / 2) * s, zoomSize * s, zoomSize * s);
      }
    }

    function highlightGroup() {
      const inputId = document.getElementById("studentId").value.trim();
      const mySeat = studentToSeat[inputId];
      if (!mySeat) return alert("その学籍番号は登録されていません。");
      const myGroup = groups.find(g=>g.includes(inputId))||[];
      const groupInfo = myGroup.map(id=>studentToSeat[id]);
      currentSeat = mySeat;
      currentGroup = groupInfo.filter(s=>s!==mySeat);
      drawSeats(currentSeat, currentGroup);
      output.innerHTML = `<strong>あなたの席:</strong> ${mySeat}<br><strong>グループ:</strong><ul>${myGroup.map(id=>`<li>${id} → ${studentToSeat[id]}${id===inputId?'（あなた）':''}</li>`).join('')}</ul>`;
    }
  </script>
</body>
</html>
