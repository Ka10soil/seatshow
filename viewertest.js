const homeScreen = document.getElementById("homeScreen");
const viewerScreen = document.getElementById("viewerScreen");
const viewercontent = document.getElementById("viewercontent");


window.addEventListener("resize", () => {
  redrawAll(); // これで描き直すだけにする
});

function goToViewer() {
  
  blackout.style.pointerEvents = 'auto';
  blackout.style.opacity = 1;
  setTimeout(() => {
    document.getElementById('homeScreen').style.display = 'none';
    document.getElementById('viewerScreen').style.display = 'none';

   
    document.getElementById('viewercontent').style.display = 'block';
    blackout.style.opacity = 0;
    blackout.style.pointerEvents = 'none';
  }, 500);

  homeScreen.classList.add("hidden");
  viewerScreen.classList.add("hidden");
  viewercontent.classList.remove("hidden");
  

  image.src = "seatmap.jpg";
  
  setTimeout(() => {
    fullImageLoaded = true;
    minimap.width = 300;
    minimap.height = image.height / image.width * minimap.width;
    drawSeats();
  }, 500);

}

function goToViewerTimer() {
  blackout.style.pointerEvents = 'auto';
  blackout.style.opacity = 1;
  setTimeout(() => {
    document.getElementById('homeScreen').style.display = 'none';


    document.getElementById('viewerScreen').style.display = 'block';
    blackout.style.opacity = 0;
    blackout.style.pointerEvents = 'none';
  }, 500);

  homeScreen.classList.add("hidden");
  viewercontent.classList.add("hidden");
  viewerScreen.classList.remove("hidden");
  updateStatus();

}




function goHome() {
  window.location.href = "indextrue.html";
}

const blackout = document.getElementById('blackout');
function showScreenWithGlitch(screenId) {
  const blackout = document.getElementById('blackout');
  const glitch = document.getElementById('glitch');

  // グリッチ発動
  glitch.style.opacity = 1;
  glitch.style.animation = 'glitchEffect 0.6s ease-in-out';

  setTimeout(() => {
    blackout.style.opacity = 1;
  }, 300);

  setTimeout(() => {
    // ここで画面切り替え！！
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    document.getElementById(screenId).classList.remove('hidden');

    // blackoutとglitchをリセット
    glitch.style.opacity = 0;
    glitch.style.animation = 'none';
    blackout.style.opacity = 0;
  }, 800);
}



const canvas = document.getElementById("seatCanvas");
const ctx = canvas.getContext("2d");
const minimap = document.getElementById("minimap");
const mctx = minimap.getContext("2d");
const output = document.getElementById("output");
const image = new Image();


const zoomSize = 650;
const zoomScale = 0.55;

const ax = 1200
const seatData = {
"A": [
  { "start": 5, "count": 3, "y": 1961, "dy": 45.4, "x": 1130.0 },
  { "start": 8, "count": 9, "y": 1730, "dy": 45.4, "x": 1130.0 },
  { "start": 19, "count": 9, "y": 1232, "dy": 45.4, "x": 1130.0 },
  { "start": 28, "count": 3, "y": 749, "dy": 45.4, "x": 1130.0 }
],
"B": [
  { "start": 5, "count": 3, "y": 1961, "dy": 45.4, "x": 1181.9 },
  { "start": 8, "count": 10, "y": 1753, "dy": 45.4, "x": 1181.9 },
  { "start": 19, "count": 9, "y": 1251, "dy": 45.4, "x": 1181.9 },
  { "start": 28, "count": 3, "y": 749, "dy": 45.4, "x": 1181.9 }
],
"C": [
  { "start": 4, "count": 4, "y": 2008, "dy": 45.4, "x": 1233.8 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1233.8 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1233.8 }
],
"D": [
  { "start": 4, "count": 4, "y": 2006, "dy": 45.4, "x": 1285.7 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1285.7 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1285.7 }
],
"E": [
  { "start": 4, "count": 4, "y": 2007, "dy": 45.4, "x": 1337.6 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1337.6 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1337.6 }
],
"F": [
  { "start": 3, "count": 5, "y": 2051, "dy": 45.4, "x": 1389.5 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1389.5 },
  { "start": 28, "count": 5, "y": 749, "dy": 45.4, "x": 1389.5 }
],
"G": [
  { "start": 3, "count": 5, "y": 2053, "dy": 45.4, "x": 1441.4 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1441.4 },
  { "start": 28, "count": 6, "y": 749, "dy": 45.4, "x": 1441.4 }
],
"H": [
  { "start": 2, "count": 6, "y": 2099, "dy": 45.4, "x": 1493.3 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1493.3 },
  { "start": 28, "count": 6, "y": 749, "dy": 45.4, "x": 1493.3 }
],
"I": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1545.2 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1545.2 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1545.2 }
],
"J": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1597.1 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1597.1 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1597.1 }
],
"K": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1649.0 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1649.0 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1649.0 }
],
"L": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1700.9 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1700.9 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1700.9 }
],

  "M": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1752.8 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1752.8 }
],
"N": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1804.7 },
  
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1804.7 }
],
"O": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1856.6 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 1856.6 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 1856.6 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1856.6 }
],
"P": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1908.5 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 1908.5 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 1908.5 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1908.5 }
],
"Q": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1960.4 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 1960.4 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 1960.4 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1960.4 }
],
"R": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2012.3 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 2012.3 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 2012.3 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2012.3 }
],
"S": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2064.2 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 2064.2 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 2064.2 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2064.2 }
],
"T": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2116.1 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 2116.1 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 2116.1 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2116.1 }
],
"U": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2168 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 2168 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 2168 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2168 }
],
"V": [
  { "start": 1, "count": 7, "x": 2278.4, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2278.4, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2278.4, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2278.4, "y": 749,  "dy": 45.4 }
],
"W": [
  { "start": 1, "count": 7, "x": 2330.3, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2330.3, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2330.3, "y": 749,  "dy": 45.4 }
],
"X": [
  { "start": 1, "count": 7, "x": 2382.2, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2382.2, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2382.2, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2382.2, "y": 749,  "dy": 45.4 }
],
"Y": [
  { "start": 1, "count": 7, "x": 2434.1, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2434.1, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2434.1, "y": 749,  "dy": 45.4 }
],
"Z": [
  { "start": 1, "count": 7, "x": 2486.0, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2486, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2486, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2486.0, "y": 749,  "dy": 45.4 }
],
"AA": [
  { "start": 1, "count": 7, "x": 2537.9, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2537.9, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2537.9, "y": 749,  "dy": 45.4 }
],
"AB": [
  { "start": 1, "count": 7, "x": 2589.8, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2589.8, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2589.8, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2589.8, "y": 749,  "dy": 45.4 }
],
"AC": [
  { "start": 1, "count": 7, "x": 2641.7, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2641.7, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2641.7, "y": 749,  "dy": 45.4 }
],
"AD": [
  { "start": 1, "count": 7, "x": 2693.6, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2693.6, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2693.6, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2693.6, "y": 749,  "dy": 45.4 }
],
"AE": [
  { "start": 1, "count": 7, "x": 2745.5, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2745.5, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2745.5, "y": 749,  "dy": 45.4 }
],
"AF": [
  { "start": 1, "count": 7, "x": 2797.4, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 5, "x": 2797.4, "y": 1730, "dy": 45.4 },
  { "start": 21, "count": 7, "x": 2797.4, "y": 1138.2, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2797.4, "y": 749,  "dy": 45.4 }
]

};


const studentToSeat = {
  "3637": "O08",
  "3508": "O09",
  "3629": "O10",
  "3409": "O11",
  "3301": "O12",
  "3904": "Z08",
  "3915": "Z09",
  "3916": "Z10",
  "3927": "Z11",
  "3905": "Z12",
  "1308": "AA28",
  "1326": "AA29",
  "1327": "AA30",
  "1304": "AA31",
  "1341": "AA32",
  "1815": "G28",
  "1821": "G29",
  "1804": "G30",
  "1816": "G31",
  "1822": "G32",
  "2839": "I28",
  "2833": "I29",
  "2830": "I30",
  "2805": "I31",
  "2803": "I32",
  "2620": "AC01",
  "2618": "AC02",
  "2628": "AC03",
  "2629": "AC04",
  "2625": "AC05",
  "2909": "M28",
  "2926": "M29",
  "2915": "M30",
  "2902": "M31",
  "2910": "M32",
  "1831": "Y08",
  "1838": "Y09",
  "1833": "Y10",
  "1834": "Y11",
  "1840": "Y12",
  "1322": "N01",
  "1309": "N02",
  "1303": "N03",
  "1310": "N04",
  "1330": "N05",
  "2338": "B08",
  "2312": "B09",
  "2317": "B10",
  "2321": "B11",
  "2306": "B12",
  "1932": "B13",
  "1933": "B14",
  "1934": "B15",
  "1927": "B16",
  "1926": "B17",
  "3713": "AE08",
  "3724": "AE09",
  "3838": "AE10",
  "3723": "AE11",
  "3727": "AE12",
  "3122": "P01",
  "3110": "P02",
  "3112": "P03",
  "3222": "P04",
  "3230": "P05",
  "1618": "AD08",
  "1617": "AD09",
  "1616": "AD10",
  "1613": "AD11",
  "1635": "AD12",
  "2213": "L28",
  "2205": "L29",
  "2234": "L30",
  "2206": "L31",
  "2220": "L32",
  "1522": "AE28",
  "1524": "AE29",
  "1506": "AE30",
  "1517": "AE31",
  "1528": "AE32",
  "1108": "I08",
  "1124": "I09",
  "1123": "I10",
  "1106": "I11",
  "1122": "I12",
  "1521": "AF28",
  "1516": "AF29",
  "1530": "AF30",
  "1529": "AF31",
  "1539": "AF32",
  "1628": "J28",
  "1622": "J29",
  "1623": "J30",
  "1630": "J31",
  "1631": "J32",
  "1614": "AD19",
  "1608": "AD20",
  "1605": "AD21",
  "1606": "AD22",
  "1611": "AD23",
  "1139": "O01",
  "1137": "O02",
  "1135": "O03",
  "1136": "O04",
  "1138": "O05",
  "1918": "M01",
  "1910": "M02",
  "1917": "M03",
  "1902": "M04",
  "1904": "M05",
  "2336": "AE01",
  "2126": "AE02",
  "2226": "AE03",
  "2709": "AE04",
  "2413": "AE05",
  "2135": "Z01",
  "2119": "Z02",
  "2125": "Z03",
  "2118": "Z04",
  "2104": "Z05",
  "2622": "AA08",
  "2635": "AA09",
  "2630": "AA10",
  "2621": "AA11",
  "2623": "AA12",
  "3616": "AA13",
  "3618": "AA14",
  "3620": "AA15",
  "3622": "AA16",
  "3634": "AA17",
  "1105": "U01",
  "1610": "U02",
  "1612": "U03",
  "1836": "U04",
  "1835": "U05",
  "2335": "AC28",
  "2901": "AC29",
  "2602": "AC30",
  "2102": "AC31",
  "2109": "AC32",
  "1940": "G08",
  "1909": "G09",
  "1911": "G10",
  "1913": "G11",
  "1916": "G12",
  "2738": "X01",
  "2331": "X02",
  "2535": "X03",
  "2528": "X04",
  "2340": "X05",
  "2405": "T08",
  "2407": "T09",
  "2417": "T10",
  "2422": "T11",
  "2434": "T12",
  "2505": "O22",
  "2222": "O23",
  "2136": "O24",
  "2204": "O25",
  "2726": "O26",
  "1235": "AA01",
  "1718": "AA02",
  "1218": "AA03",
  "1221": "AA04",
  "1234": "AA05",
  "2412": "Z19",
  "2624": "Z20",
  "2720": "Z21",
  "2721": "Z22",
  "2129": "Z23",
  "3309": "L01",
  "3318": "L02",
  "3331": "L03",
  "3335": "L04",
  "3310": "L05",
  "1129": "X08",
  "1127": "X09",
  "1121": "X10",
  "1128": "X11",
  "1101": "X12",
  "2707": "A19",
  "2714": "A20",
  "2727": "A21",
  "2729": "A22",
  "2730": "A23",
  "3311": "I13",
  "3330": "I14",
  "3421": "I15",
  "3714": "I16",
  "3715": "I17",
  "2626": "G03",
  "2610": "G04",
  "2613": "G05",
  "2614": "G06",
  "2627": "G07",
  "3324": "K08",
  "3316": "K09",
  "3333": "K10",
  "3334": "K11",
  "3626": "K12",
  "3428": "U22",
  "3429": "U23",
  "3418": "U24",
  "3441": "U25",
  "1226": "Q22",
  "1220": "Q23",
  "1224": "Q24",
  "1222": "Q25",
  "2235": "T28",
  "2223": "T29",
  "2232": "T30",
  "2236": "T31",
  "2937": "D28",
  "2930": "D29",
  "2925": "D30",
  "2931": "D31",
  "3419": "C08",
  "3411": "C09",
  "3438": "C10",
  "3437": "C11",
  "2813": "A08",
  "2814": "A09",
  "2831": "A10",
  "2809": "A11",
  "2924": "E08",
  "2916": "E09",
  "2917": "E10",
  "2919": "E11",

  "3902": "H28",
  "3906": "H29",
  "3914": "H30",
  "3918": "H31",

  "3504": "I01",
  "3510": "I02",
  "3612": "I03",
  "3810": "I04",

  "1826": "S22",
  "1813": "S23",
  "1812": "S24",
  "1827": "S25",
  "3738": "F28",
  "3729": "F29",
  "3726": "F30",
  "3725": "F31",
//change
"3834":"F32",

  "1239": "R22",
  "1230": "R23",
  "1229": "R24",
  "1240": "R25",
  "2802": "U28",
  "2832": "U29",
  "2825": "U30",
  "2836": "U31",
  "2311": "Q28",
  "2314": "Q29",
  "2323": "Q30",
  "2332": "Q31",
  "3202": "A12",
  "3223": "A13",
  "3131": "A14",
  "3605": "A15",
  "1901": "D08",
  "1930": "D09",
  "1936": "D10",
  "1935": "D11",
  "1715": "AE13",
  "1729": "AE14",
  "1730": "AE15",
  "1717": "AE16",
  "1213": "J08",
  "1233": "J09",
  "1525": "J10",
  "1134": "J11",
  "1637": "Z13",
  "1625": "Z14",
  "1634": "Z15",
  "1615": "Z16",
  "1723": "J12",
  "1725": "J13",
  "1720": "J14",
  "1706": "J15",
  "1640": "V08",
  "1627": "V09",
  "1633": "V10",
  "1636": "V11",
  "1728": "D04",
  "1727": "D05",
  "1712": "D06",
  "1724": "D07",
  "3721": "O28",
  "3220": "O29",
  "3212": "O30",
  "3820": "O31",
  "1120": "W28",
  "1115": "W29",
  "1125": "W30",
  "1130": "W31",
  "3735": "W08",
  "3535": "W09",
  "3306": "W10",
  "3708": "W11",
  "1739": "AA18",
  "1401": "AA19",
  "1219": "AA20",
  "1133": "AA21",
  "3730": "S28",
  "3141": "S29",
  "3439": "S30",
  "3632": "S31",
  "1708": "Z24",
  "1701": "Z25",
  "1703": "Z26",
  "1704": "Z27",
  "2301": "D12",
  "2304": "D13",
  "2305": "D14",
  "2333": "D15",
  "3113": "G13",
  "3139": "G14",
  "3704": "G15",
  "3128": "G16",
  "1914": "P08",
  "1928": "P09",
  "1938": "P10",
  "1939": "P11",
  "2824": "F03",
  "2817": "F04",
  "2504": "F05",
  "2837": "F06",
  "3105": "V12",
  "3107": "V13",
  "3114": "V14",
  "3807": "V15",
  "1810": "AB28",
  "1819": "AB29",
  "1811": "AB30",
  "1707": "AB31",
  "2229": "P28",
  "2835": "P29",
  "2327": "P30",
  "2230": "P31",
  "1132": "S01",
  "1110": "S02",
  "1109": "S03",
  "1103": "S04",
  "3539": "J01",
  "3530": "J02",
  "3529": "J03",
  "3524": "J04",
  "1201": "AE17",
  "1217": "AE18",
  "1223": "AE19",
  "1205": "AE20",
  "1113": "W12",
  "1102": "W13",
  "1334": "W14",
  "1335": "W15",
  
  "3217": "X28",
  "3502": "X29",
  "3432": "X30",
  "3937": "X31",
  "2408": "R01",
  "2421": "R02",
  "2436": "R03",
  "2437": "R04",
  "2606": "AE21",
  "2637": "AE22",
  "2705": "AE23",
  "2329": "AE24",
  "3135": "S08",
  "3238": "S09",
  "3315": "S10",
  "3836": "S11",
  "3213": "X13",
  "3835": "X14",
  "3520": "X15",
  "3328": "X16",
  "3130": "E04",
  "3304": "E05",
  "3308": "E06",
  "3827": "E07",
  "3627": "P22",
  "3619": "P23",
  "3537": "P24",
  "3329": "P25",
  "3430": "AB01",
  "3506": "AB02",
  "3601": "AB03",
  "3636": "AB04",
  "3702": "Y13",
  "3706": "Y14",
  "3705": "Y15",
  "3733": "Y16",
  "1520": "R28",
  "1534": "R29",
  "1503": "R30",
  "1504": "R31",
  "1321": "Q01",
  "1317": "Q02",
  "1318": "Q03",
  "1315": "Q04",
  "3111": "T22",
  "3208": "T23",
  "3312": "T24",
  "3116": "T25",
  "3829": "I18",
  "3808": "I19",
  "3822": "I20",
  "3129": "I21",
  "3138": "Z28",
  "3305": "Z29",
  "3435": "Z30",
  "3920": "Z31",
  "1738": "I22",
  "1726": "I23",
  "1732": "I24",
  "1736": "I25",
  "2737": "R08",
  "2719": "R09",
  "2233": "R10",
  "2224": "R11",
  "1419": "AD13",
  "1427": "AD14",
  "1424": "AD15",
  "1404": "AD16",
  "3340": "C28",
  "3317": "C29",
  "3321": "C30",
  "3326": "C31",
  "2736": "Y01",
  "2739": "Y02",
  "2728": "Y03",
  "2717": "Y04",
  "3538": "AD24",
  "3532": "AD25",
  "3234": "AD26",
  "3621": "AD27",
  "2117": "V01",
  "2133": "V02",
  "2121": "V03",
  "2103": "V04",
  "2426": "AF08",
  "2440": "AF09",
  "2404": "AF10",
  "2106": "AF11",
  "2140": "AB19",
  "3720": "AB20",
  "3240": "AB21",
  "3509": "AB22",
  "3313": "AD28",
  "3123": "AD29",
  "3828": "AD30",
  "3501": "AD31",
  "2507": "V28",
  "2526": "V29",
  "2522": "V30",
  "2508": "V31",
  "3607": "E28",
  "3603": "E29",
  "3617": "E30",
  "3540": "I05",
  "3522": "I06",
  "3115": "I07",
  "1232": "AF21",
  "1208": "AF22",
  "1237": "AF23",
  "3907": "P32",
  "3926": "P33",
  "3928": "P34",
  "1206": "H08",
  "1202": "H09",
  "1238": "H10",
  "2807": "Q08",
  "2804": "Q09",
  "2811": "Q10",
  "1440": "V19",
  "1434": "V20",
  "1433": "V21",
  "3609": "Q05",
  "3611": "Q06",
  "3628": "Q07",
  "2808": "W01",
  "2826": "W02",
  "2525": "W03",
  "1320": "L08",
  "1313": "L09",
  "1328": "L10",
  "3624": "AF01",
  "3817": "AF02",
  "3215": "AF03",
  "1306": "W32",
  "1314": "W33",
  "1312": "W34",
  "3734": "V05",
  "3710": "V06",
  "3433": "V07",
  "1839": "AE25",
  "1829": "AE26",
  "1823": "AE27",
  "1832": "AB23",
  "1828": "AB24",
  "1825": "AB25",
  "2904": "U08",
  "2911": "U09",
  "2914": "U10",
  "2908": "Q32",
  "2912": "Q33",
  "2934": "Q34",
  "3709": "K28",
  "3736": "K29",
  "3739": "K30",
  "1437": "W16",
  "1439": "W17",
  "1432": "W18",
  "2820": "AC08",
  "2815": "AC09",
  "2822": "AC10",
  "1425": "R05",
  "1431": "R06",
  "1428": "R07",
  "1502": "U32",
  "1501": "U33",
  "1509": "U34",
  "1922": "C04",
  "1903": "C05",
  "1915": "C06",
  "1510": "G17",
  "1511": "G18",
  "1512": "G19",
  "2302": "A05",
  "2303": "A06",
  "2309": "A07",
  "1923": "B28",
  "1919": "B29",
  "1920": "B30",
  "3434": "N28",
  "3424": "N29",
  "3403": "N30",
  "1515": "Y17",
  "1508": "Y18",
  "1514": "Y19",
  "2913": "Z32",
  "2920": "Z33",
  "2903": "Z34",
  "2616": "AD01",
  "2415": "AD02",
  "2631": "AD03",
  "3231": "X32",
  "3207": "X33",
  "3225": "X34",
  "2634": "A28",
  "2723": "A29",
  "2425": "A30",
  "1907": "AD04",
  "1905": "AD05",
  "1908": "AD06",
  "2731": "A24",
  "2732": "A25",
  "2722": "A26",
  "3332": "H11",
  "3336": "H12",
  "3323": "H13",
  "2319": "S05",
  "2324": "S06",
  "2617": "S07",
  "1620": "AB32",
  "1602": "AB33",
  "1626": "AB34",
  "3801": "K13",
  "3814": "K14",
  "3821": "K15",
  "2715": "D16",
  "2733": "D17",
  "2711": "D18",
  "2701": "Y05",
  "2704": "Y06",
  "2716": "Y07",
  "1114": "E12",
  "1126": "E13",
  "1118": "E14",
  "1111": "D19",
  "1141": "D20",
  "1104": "D21",
  "1410": "N31",
  "1407": "N32",
  "1409": "N33",
  "3216": "V32",
  "3604": "V33",
  "3201": "V34",
  "2438": "AF24",
  "2402": "AF25",
  "2122": "AF26",
  "2401": "U11",
  "2420": "U12",
  "2435": "U13",
  "3712": "S32",
  "3929": "S33",
  "3633": "S34",
  "3802": "J05",
  "3420": "J06",
  "3513": "J07",
  "3521": "E15",
  "3718": "E16",
  "3716": "E17",
  "1533": "E18",
  "1415": "E19",
  "1236": "E20",
  "3815": "Y20",
  "3519": "Y21",
  "3833": "Y22",
  "3402": "R32",
  "3413": "R33",
  "3426": "R34",
  "1117": "AC11",
  "1805": "AC12",
  "1131": "AC13",
  "2821": "E21",
  "2834": "E22",
  "2819": "E23",
  "1619": "V22",
  "1609": "V23",
  "1906": "V24",
  "1214": "AD32",
  "1207": "AD33",
  "1203": "AD34",
  "2428": "C12",
  "2221": "C13",
  "2414": "C14",
  "2532": "O32",
  "2202": "O33",
  "2315": "O34",
  "2530": "T32",
  "2533": "T33",
  "2511": "T34",
  "1741": "F08",
  "1737": "F09",
  "1735": "F10",
  "3237": "F11",
  "3813": "F12",
  "3233": "F13",
  "2907": "V25",
  "2938": "V26",
  "2940": "V27",
  "3610": "AF04",
  "3528": "AF05",
  "3925": "AF06",
  "1705": "D22",
  "1719": "D23",
  "1721": "D24",
  "2120": "H14",
  "2113": "H15",
  "2105": "H16",
  "2933": "T01",
  "2906": "T02",
  "2921": "T03",
  "2928": "Y28",
  "2929": "Y29",
  "2519": "Y30",
  "2423": "Y23",
  "2424": "Y24",
  "2431": "Y25",
  "3518": "E24",
  "3525": "E25",
  "3422": "E26",
  "1601": "H02",
  "1604": "H03",
  "1632": "H04",
  "2240": "X19",
  "2823": "X20",
  "2812": "X21",
  "3840": "K16",
  "3541": "K17",
  "3109": "K18",
  "3503": "AB08",
  "3516": "AB09",
  "3211": "AB10",
  "2515": "K31",
  "2516": "K32",
  "2806": "K33",
  "3132": "B19",
  "3134": "B20",
  "3740": "B21",
  "3625": "K01",
  "3635": "K02",
  "3511": "K03",
  "2816": "AB11",
  "2239": "AB12",
  "2702": "AB13",
  "3203": "L11",
  "3206": "L12",
  "3228": "L13",
  "2509": "AB14",
  "2108": "AB15",
  "2640": "AB16",
  "2110": "H05",
  "2416": "H06",
  "2608": "H07",
  "2216": "L14",
  "2207": "L15",
  "2212": "L16",
  "1430": "AC14",
  "1429": "AC15",
  "1422": "AC16",
  "2510": "H17",
  "2429": "H18",
  "2406": "H19",
  "3935": "AC17",
  "3936": "AC18",
  "3901": "O06",
  "3919": "O07",
  "3826": "G20",
  "3106": "G21",
  "1302": "X06",
  "1329": "X07",
  "2827": "I26",
  "2840": "I27",
  "3436": "P26",
  "3839": "P27",
  "3303": "AE06",
  "3307": "AE07",
  "3417": "V16",
  "3404": "V17",
  "2918": "N06",
  "2935": "N07",
  "1311": "AB26",
  "1307": "AB27",
  "2433": "AC06",
  "2219": "AC07",
  "3923": "L17",
  "3921": "L18",
  "2603": "AC19",
  "2609": "AC20",
  "3737": "L06",
  "3805": "L07",
  "3423": "B22",
  "3407": "B23",
  "2611": "S26",
  "2638": "S27",
  "1814": "W04",
  "1817": "W05",
  "2607": "G22",
  "2601": "G23",
  "2615": "I33",
  "2605": "I34",
  "3405": "W06",
  "3412": "W07",
  "1709": "C15",
  "1702": "C16",
  "1411": "AC21",
  "1405": "AC22",
  "1438": "Q26",
  "1338": "Q27",
  "1531": "Y31",
  "1526": "Y32",
  "1305": "D25",
  "1412": "D26",
  "3124": "Q11",
  "3127": "Q12",
  "1507": "H32",
  "1535": "H33",
  "1324": "AA06",
  "1435": "AA07",
  "1818": "Z06",
  "1837": "Z07",
  "2203": "L19",
  "2218": "L20",
  "2521": "C17",
  "2529": "C18",
  "2712": "R12",
  "2710": "R13",
  "2310": "AC33",
  "2339": "AC34",
  "1921": "T26",
  "1929": "T27",
  "1332": "M33",
  "1325": "M34",
  "1519": "P12",
  "1518": "P13",
  "2724": "F14",
  "2537": "F15",
  "1333": "B05",
  "1809": "B06",
  "2713": "Y26",
  "2112": "Y27",
  "2123": "T04",
  "2114": "T05",
  "3701": "AC23",
  "3707": "AC24",
  "2210": "S12",
  "2215": "S13",
  "2735": "AA22",
  "2734": "AA23",
  "3703": "AB05",
  "3804": "AB06",
  "2538": "P06",
  "2512": "P07",
  "3338": "K04",
  "3339": "K05",
  "1408": "H20",
  "1414": "H21",
  "1402": "W19",
  "1925": "W20",
  "2116": "J33",
  "2308": "J34",
  "3320": "G24",
  "3534": "G25",
  "2619": "AA33",
  "2632": "AA34",
  "1204": "J16",
  "1216": "J17",
  "3732": "C19",
  "3613": "C20",
  "2636": "M06",
  "2237": "M07",
  "1323": "G26",
  "1331": "G27",
  "2124": "F16",
  "2111": "F17",
  "3406": "B24",
  "3232": "B25",
  "1209": "AF33",
  "1227": "AF34",
  "3830": "R26",
  "3533": "R27",
  "3823": "AC25",
  "3103": "AC26",
  "3831": "C21",
  "3837": "C22",
  "1337": "T06",
  "1319": "T07",
  "1420": "AA24",
  "1403": "AA25",
  "2101": "U26",
  "3440": "U27",
  "2801": "K06",
  "2320": "K07",
  "3415": "B26",
  "3408": "B27",
  "3908": "C23",
  "3818": "C24",
  "2540": "AE33",
  "2539": "AE34",
  "3416": "L33",
  "3241": "L34",
  "3229": "L21",
  "3536": "L22",
  "2708": "W21",
  "2725": "W22",
  "3214": "Y33",
  "3205": "Y34",
  "2534": "W23",
  "2502": "W24",
  "2211": "J18",
  "2214": "J19",
  "2107": "F18",
  "2328": "F19",
  "2427": "J20",
  "2432": "J21",
  "2334": "H22",
  "2325": "H23",
  "1713": "C25",
  "1714": "C26",
  "2128": "L23",
  "2127": "L24",
  "1436": "J22",
  "1603": "J23",
  "1225": "L25",
  "1228": "L26",
  "2536": "F20",
  "2513": "F21",
  "2411": "W25",
  "2410": "W26",
  "3507": "U06",
  "3531": "U07",
  "1807": "F22",
  "1802": "F23",
  "3218": "J24",
  "3136": "J25",
  "3909": "X22",
  "3337": "X23",
  "3121": "F24",
  "3717": "F25",
  "3133": "K19",
  "3119": "K20",
  "3401": "J26",
  "3431": "J27",
  "1426": "F26",
  "1523": "F27",
  "1421": "X24",
  "1711": "X25",
  "3204": "X26",
  "3226": "X27",
  "3314": "AA26",
  "3515": "AA27",
  "1722": "H24",
  "1716": "H25",
  "1423": "K21",
  "1416": "K22",
  "3322": "K23",
  "3615": "K24",
  "2818": "B07",
  "2403": "G33",
  "2130": "F07",
  "1801": "A27",
  "1527": "E31",
  "3731": "W27",
  "1830": "A16",
  "2337": "AD17",
  "2231": "Z17",
  "1532": "Q13",
  "2927": "C07",
  "1808": "T13",
  "2322": "O27",
  "2217": "D27",
  "1731": "O13",
  "1607": "AB17",
  "1505": "AF12",
  "1211": "N34",
  "1413": "K25",
  "2524": "AC27",
  "1210": "H26",
  "1406": "L27",
  "1301": "E27",
  "1621": "K26",
  "3639": "X17",
  "1112": "AD07",
  "2520": "AF07",
  "1140": "H27",
  "3425": "K34",
  "2936": "C27",
  "1116": "AF27",
  "1734": "K27",
  "1536": "AB07",
};

const groups = [
  ['3428', '3429', '3418', '3441'] ,
  ['1226', '1220', '1224', '1222'] ,
  ['3607', '3603', '3617'] ,
  ['3904', '3915', '3916', '3927', '3905'] ,
  ['3540', '3522', '3115'] ,
  ['3935', '3936'] ,
  ['3901', '3919'] ,
  ['2235', '2223', '2232', '2236'] ,
  ['3826', '3106'] ,
  ['1232', '1208', '1237'] ,
  ['2937', '2930', '2925', '2931'] ,
  ['3419', '3411', '3438', '3437'] ,
  ['3907', '3926', '3928'] ,
  ['1206', '1202', '1238'] ,
  ['2807', '2804', '2811'] ,
  ['1440', '1434', '1433'] ,
  ['1302', '1329'] ,
  ['2827', '2840'] ,
  ['3436', '3839'] ,
  ['2818'] ,
  ['3303', '3307'] ,
  ['3609', '3611', '3628'] ,
  ['2403'] ,
  ['2808', '2826', '2525'] ,
  ['3417', '3404'] ,
  ['2918', '2935'] ,
  ['1320', '1313', '1328'] ,
  ['1311', '1307'] ,
  ['1308', '1326', '1327', '1304', '1341'] ,
  ['2813', '2814', '2831', '2809'] ,
  ['2924', '2916', '2917', '2919'] ,
  ['2433', '2219'] ,
  ['3923', '3921'] ,
  ['3624', '3817', '3215'] ,
  ['3902', '3906', '3914', '3918'] ,
  ['2603', '2609'] ,
  ['1306', '1314', '1312'] ,
  ['1826', '1813', '1812', '1827'] ,
  ['3734', '3710', '3433'] ,
  ['3738', '3729', '3726', '3725','3834'] ,
  ['3737', '3805'] ,
  ['3423', '3407'] ,
  ['1839', '1829', '1823'] ,
  ['2611', '2638'] ,
  ['2130'] ,
  ['1832', '1828', '1825'] ,
  ['2904', '2911', '2914'] ,
  ['2908', '2912', '2934'] ,
  ['1815', '1821', '1804', '1816', '1822'] ,
  ['1239', '1230', '1229', '1240'] ,
  ['1814', '1817'] ,
  ['2607', '2601'] ,
  ['3709', '3736', '3739'] ,
  ['2802', '2832', '2825', '2836'] ,
  ['1437', '1439', '1432'] ,
  ['2615', '2605'] ,
  ['2820', '2815', '2822'] ,
  ['3405', '3412'] ,
  ['2839', '2833', '2830', '2805', '2803'] ,
  ['1801'] ,
  ['1709', '1702'] ,
  ['2620', '2618', '2628', '2629', '2625'] ,
  ['2311', '2314', '2323', '2332'] ,
  ['1411', '1405'] ,
  ['1527'] ,
  ['2909', '2926', '2915', '2902', '2910'] ,
  ['1425', '1431', '1428'] ,
  ['1438', '1338'] ,
  ['1531', '1526'] ,
  ['1502', '1501', '1509'] ,
  ['1305', '1412'] ,
  ['1922', '1903', '1915'] ,
  ['1510', '1511', '1512'] ,
  ['3124', '3127'] ,
  ['1507', '1535'] ,
  ['1831', '1838', '1833', '1834', '1840'] ,
  ['3202', '3223', '3131', '3605'] ,
  ['1324', '1435'] ,
  ['1901', '1930', '1936', '1935'] ,
  ['1322', '1309', '1303', '1310', '1330'] ,
  ['1715', '1729', '1730', '1717'] ,
  ['2338', '2312', '2317', '2321', '2306'] ,
  ['2302', '2303', '2309'] ,
  ['1818', '1837'] ,
  ['3731'] ,
  ['1923', '1919', '1920'] ,
  ['1213', '1233', '1525', '1134'] ,
  ['3434', '3424', '3403'] ,
  ['1830'] ,
  ['1932', '1933', '1934', '1927', '1926'] ,
  ['1515', '1508', '1514'] ,
  ['2337'] ,
  ['3713', '3724', '3838', '3723', '3727'] ,
  ['2203', '2218'] ,
  ['3122', '3110', '3112', '3222', '3230'] ,
  ['2913', '2920', '2903'] ,
  ['1637', '1625', '1634', '1615'] ,
  ['2616', '2415', '2631'] ,
  ['2521', '2529'] ,
  ['1723', '1725', '1720', '1706'] ,
  ['1618', '1617', '1616', '1613', '1635'] ,
  ['2712', '2710'] ,
  ['2310', '2339'] ,
  ['1640', '1627', '1633', '1636'] ,
  ['2213', '2205', '2234', '2206', '2220'] ,
  ['3231', '3207', '3225'] ,
  ['1728', '1727', '1712', '1724'] ,
  ['3721', '3220', '3212', '3820'] ,
  ['2634', '2723', '2425'] ,
  ['1921', '1929'] ,
  ['2231'] ,
  ['1332', '1325'] ,
  ['1519', '1518'] ,
  ['1532'] ,
  ['1120', '1115', '1125', '1130'] ,
  ['3735', '3535', '3306', '3708'] ,
  ['2724', '2537'] ,
  ['1522', '1524', '1506', '1517', '1528'] ,
  ['1108', '1124', '1123', '1106', '1122'] ,
  ['1333', '1809'] ,
  ['1521', '1516', '1530', '1529', '1539'] ,
  ['1907', '1905', '1908'] ,
  ['1739', '1401', '1219', '1133'] ,
  ['3730', '3141', '3439', '3632'] ,
  ['1708', '1701', '1703', '1704'] ,
  ['2713', '2112'] ,
  ['2927'] ,
  ['2301', '2304', '2305', '2333'] ,
  ['2123', '2114'] ,
  ['3701', '3707'] ,
  ['2731', '2732', '2722'] ,
  ['1628', '1622', '1623', '1630', '1631'] ,
  ['3332', '3336', '3323'] ,
  ['2319', '2324', '2617'] ,
  ['2210', '2215'] ,
  ['2735', '2734'] ,
  ['1614', '1608', '1605', '1606', '1611'] ,
  ['1620', '1602', '1626'] ,
  ['3703', '3804'] ,
  ['3113', '3139', '3704', '3128'] ,
  ['2538', '2512'] ,
  ['1914', '1928', '1938', '1939'] ,
  ['3801', '3814', '3821'] ,
  ['1139', '1137', '1135', '1136', '1138'] ,
  ['2824', '2817', '2504', '2837'] ,
  ['3105', '3107', '3114', '3807'] ,
  ['1810', '1819', '1811', '1707'] ,
  ['1918', '1910', '1917', '1902', '1904'] ,
  ['2715', '2733', '2711'] ,
  ['2701', '2704', '2716'] ,
  ['2229', '2835', '2327', '2230'] ,
  ['2336', '2126', '2226', '2709', '2413'] ,
  ['1114', '1126', '1118'] ,
  ['3338', '3339'] ,
  ['2135', '2119', '2125', '2118', '2104'] ,
  ['2622', '2635', '2630', '2621', '2623'] ,
  ['1132', '1110', '1109', '1103'] ,
  ['1111', '1141', '1104'] ,
  ['3539', '3530', '3529', '3524'] ,
  ['1410', '1407', '1409'] ,
  ['1408', '1414'] ,
  ['1201', '1217', '1223', '1205'] ,
  ['1113', '1102', '1334', '1335'] ,
  ['3504', '3510', '3612', '3810'] ,
  ['3616', '3618', '3620', '3622', '3634'] ,
  ['1402', '1925'] ,
  ['3216', '3604', '3201'] ,
  ['3217', '3502', '3432', '3937'] ,
  ['2116', '2308'] ,
  ['3320', '3534'] ,
  ['2619', '2632'] ,
  ['1204', '1216'] ,
  ['2438', '2402', '2122'] ,
  ['1105', '1610', '1612', '1836', '1835'] ,
  ['2408', '2421', '2436', '2437'] ,
  ['2401', '2420', '2435'] ,
  ['3732', '3613'] ,
  ['2636', '2237'] ,
  ['3712', '3929', '3633'] ,
  ['3802', '3420', '3513'] ,
  ['1323', '1331'] ,
  ['3508', '3629', '3637', '3409', '3301'] ,
  ['3521', '3718', '3716'] ,
  ['2606', '2637', '2705', '2329'] ,
  ['1533', '1415', '1236'] ,
  ['3135', '3238', '3315', '3836'] ,
  ['3213', '3835', '3520', '3328'] ,
  ['3815', '3519', '3833'] ,
  ['3402', '3413', '3426'] ,
  ['2124', '2111'] ,
  ['1117', '1805', '1131'] ,
  ['3130', '3304', '3308', '3827'] ,
  ['3406', '3232'] ,
  ['1209', '1227'] ,
  ['3830', '3533'] ,
  ['2821', '2834', '2819'] ,
  ['1808'] ,
  ['3627', '3619', '3537', '3329'] ,
  ['1619', '1609', '1906'] ,
  ['2335', '2901', '2602', '2102', '2109'] ,
  ['3823', '3103'] ,
  ['3831', '3837'] ,
  ['3430', '3506', '3601', '3636'] ,
  ['1940', '1909', '1911', '1913', '1916'] ,
  ['1214', '1207', '1203'] ,
  ['2322'] ,
  ['2428', '2221', '2414'] ,
  ['2738', '2331', '2535', '2528', '2340'] ,
  ['2532', '2202', '2315'] ,
  ['3702', '3706', '3705', '3733'] ,
  ['1520', '1534', '1503', '1504'] ,
  ['2405', '2407', '2417', '2422', '2434'] ,
  ['1337', '1319'] ,
  ['1420', '1403'] ,
  ['2530', '2533', '2511'] ,
  ['2101', '3440'] ,
  ['2505', '2222', '2136', '2204', '2726'] ,
  ['1741', '1737', '1735'] ,
  ['3237', '3813', '3233'] ,
  ['2217'] ,
  ['1731'] ,
  ['2907', '2938', '2940'] ,
  ['2801', '2320'] ,
  ['3610', '3528', '3925'] ,
  ['1235', '1718', '1218', '1221', '1234'] ,
  ['1321', '1317', '1318', '1315'] ,
  ['1607'] ,
  ['3415', '3408'] ,
  ['1505'] ,
  ['3111', '3208', '3312', '3116'] ,
  ['3829', '3808', '3822', '3129'] ,
  ['3138', '3305', '3435', '3920'] ,
  ['3908', '3818'] ,
  ['1705', '1719', '1721'] ,
  ['1738', '1726', '1732', '1736'] ,
  ['1211'] ,
  ['2412', '2624', '2720', '2721', '2129'] ,
  ['1413'] ,
  ['2540', '2539'] ,
  ['2737', '2719', '2233', '2224'] ,
  ['3416', '3241'] ,
  ['3309', '3318', '3331', '3335', '3310'] ,
  ['3229', '3536'] ,
  ['1129', '1127', '1121', '1128', '1101'] ,
  ['2524'] ,
  ['1419', '1427', '1424', '1404'] ,
  ['2120', '2113', '2105'] ,
  ['2933', '2906', '2921'] ,
  ['2707', '2714', '2727', '2729', '2730'] ,
  ['3340', '3317', '3321', '3326'] ,
  ['2708', '2725'] ,
  ['2928', '2929', '2519'] ,
  ['1210'] ,
  ['3214', '3205'] ,
  ['2534', '2502'] ,
  ['2736', '2739', '2728', '2717'] ,
  ['2211', '2214'] ,
  ['2423', '2424', '2431'] ,
  ['2107', '2328'] ,
  ['3518', '3525', '3422'] ,
  ['2427', '2432'] ,
  ['3538', '3532', '3234', '3621'] ,
  ['1601', '1604', '1632'] ,
  ['2240', '2823', '2812'] ,
  ['2334', '2325'] ,
  ['1713', '1714'] ,
  ['2128', '2127'] ,
  ['1436', '1603'] ,
  ['1225', '1228'] ,
  ['2117', '2133', '2121', '2103'] ,
  ['2536', '2513'] ,
  ['1406'] ,
  ['3840', '3541', '3109'] ,
  ['2411', '2410'] ,
  ['3503', '3516', '3211'] ,
  ['2426', '2440', '2404', '2106'] ,
  ['3507', '3531'] ,
  ['1807', '1802'] ,
  ['2140', '3720', '3240', '3509'] ,
  ['3218', '3136'] ,
  ['2515', '2516', '2806'] ,
  ['3132', '3134', '3740'] ,
  ['3313', '3123', '3828', '3501'] ,
  ['3625', '3635', '3511'] ,
  ['2816', '2239', '2702'] ,
  ['3909', '3337'] ,
  ['3203', '3206', '3228'] ,
  ['2509', '2108', '2640'] ,
  ['2110', '2416', '2608'] ,
  ['2216', '2207', '2212'] ,
  ['1301'] ,
  ['3121', '3717'] ,
  ['1621'] ,
  ['1430', '1429', '1422'] ,
  ['3133', '3119'] ,
  ['2510', '2429', '2406'] ,
  ['3639'] ,
  ['3401', '3431'] ,
  ['1112'] ,
  ['3311', '3330', '3421', '3714', '3715'] ,
  ['2520'] ,
  ['1426', '1523'] ,
  ['1140'] ,
  ['1421', '1711'] ,
  ['2507', '2526', '2522', '2508'] ,
  ['3204', '3226'] ,
  ['2626', '2610', '2613', '2614', '2627'] ,
  ['3425'] ,
  ['3314', '3515'] ,
  ['2936'] ,
  ['3324', '3316', '3333', '3334', '3626'] ,
  ['1722', '1716'] ,
  ['1423', '1416'] ,
  ['1116'] ,
  ['1734'] ,
  ['1536'] ,
  ['3322', '3615']
];

let highlightBox = null;
let zoomedIn = true;
let fullImageLoaded = false;
let currentSeat = null;
let currentGroup = [];



minimap.addEventListener("click", () => {
  zoomedIn = !zoomedIn;
  drawSeats(currentSeat, currentGroup);
});

function drawSeats(mySeat = null, groupSeats = []) {
  if (!fullImageLoaded) return;

  let highlight = null;
  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        if (label === mySeat) {
          highlight = { x: segment.x, y: segment.y - segment.dy * i };
        }
      }
    }
  }

  highlightBox = highlight;
  const ratio = window.devicePixelRatio || 1; // 追加: ディスプレイ解像度
  
  const scale = (zoomedIn && highlightBox) ? zoomScale : 1;

  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  


  if (zoomedIn && highlightBox) {
    const sx = Math.max(0, highlightBox.x - zoomSize / 2);
    const sy = Math.max(0, highlightBox.y - zoomSize / 2);
  
    // キャンバスの内部サイズをratio倍
    canvas.width = zoomSize * zoomScale * ratio;
    canvas.height = zoomSize * zoomScale * ratio;
  
    // CSSの見た目サイズは変えない
    canvas.style.width = (zoomSize * zoomScale) + "px";
    canvas.style.height = (zoomSize * zoomScale) + "px";
  
    // スケール調整
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  
    ctx.drawImage(
      image,
      sx, sy, zoomSize, zoomSize, // 元画像から切り取る部分
      0, 0, zoomSize * zoomScale, zoomSize * zoomScale // キャンバスに描くサイズ
    );
    
    
  } else {
    
   const baseW = image.naturalWidth;
  const baseH = image.naturalHeight;


// スマホ画面の幅に合わせて表示サイズを決める
const maxDisplayWidth = canvas.parentElement.clientWidth || window.innerWidth;
const scale = maxDisplayWidth / baseW;

// CSSの見た目サイズ（ディスプレイ用）
canvas.style.width = (baseW * scale) + "px";
canvas.style.height = (baseH * scale) + "px";

// 内部ピクセルサイズを ratio 倍
canvas.width = baseW * ratio;
canvas.height = baseH * ratio;

// 高DPI対応で拡大描画
ctx.setTransform(ratio, 0, 0, ratio, 0, 0);

// 画像描画（切り出しなし）
ctx.imageSmoothingEnabled = false;
ctx.drawImage(
  image,
  0, 0, baseW, baseH,  // 元画像の全体を
  0, 0, baseW, baseH   // キャンバスにも等倍で描画
);

    

  } 
  
  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        let x = segment.x;
        let y = segment.y - segment.dy * i;

        if (zoomedIn && highlightBox) {
          x = (x - highlightBox.x + zoomSize / 2) * zoomScale;
          y = (y - highlightBox.y + zoomSize / 2) * zoomScale;
        }

        ctx.beginPath();
        const size = 35 * scale; // 直径と同じサイズ

        if (label === mySeat) {
            ctx.shadowBlur = 15;
            ctx.shadowColor = "rgba(255, 0, 0, 0.8)";
            ctx.strokeStyle = "rgb(242, 255, 0, 0.6)";
            ctx.lineWidth = 4;
            ctx.strokeRect(x - size/2, y - size/2, size, size);
          } else {
            ctx.shadowBlur = 0;
            ctx.shadowColor = "transparent";
        }

        ctx.fillStyle = groupSeats.includes(label) 
        ? "rgba(100, 200, 255, 0.3)"
        : (label === mySeat ? "rgba(190, 70, 255, 0.3)" : "rgba(255, 255, 255, 0.2)");

        ctx.fillRect(x - size/2, y - size/2, size, size);
      }
    }
  }

  const s = minimap.width / image.width;
  mctx.clearRect(0, 0, minimap.width, minimap.height);
  mctx.drawImage(image, 0, 0, minimap.width, minimap.height);
  if (highlightBox) {
    mctx.strokeStyle = "red";
    mctx.lineWidth = 1;
    mctx.strokeRect(
      (highlightBox.x - zoomSize / 2) * s,
      (highlightBox.y - zoomSize / 2) * s,
      zoomSize * s,
      zoomSize * s
    );
  }
}

function highlightGroup() {
  const inputId = document.getElementById("studentId").value.trim();
  const mySeat = studentToSeat[inputId];
  if (!mySeat) {
    currentSeat = null;
    currentGroup = [];
    output.innerHTML = "<strong>エラー:</strong> HRNOが登録されていません。";
    drawSeats();
    return;
  }

  zoomedIn = true;
  const myGroup = groups.find(g => g.includes(inputId)) || [];
  const groupInfo = myGroup.map(id => ({ id, seat: studentToSeat[id] || "-" }));

  currentSeat = mySeat;
  currentGroup = groupInfo.map(g => g.seat).filter(s => s !== mySeat);

  drawSeats(currentSeat, currentGroup);

  groupInfo.sort((a, b) => {
    const [aCol, aRow] = [a.seat[0], parseInt(a.seat.slice(1))];
    const [bCol, bRow] = [b.seat[0], parseInt(b.seat.slice(1))];
  
    if (aCol !== bCol) return bCol.localeCompare(aCol); // 列を逆順
    return bRow - aRow; // 数字を逆順
  });
  
  output.innerHTML = `
    <strong>あなたの席:</strong> ${mySeat}<br>
    <strong>グループメンバーの席:</strong><br>
    <ul>
      ${groupInfo.map(g => `<li>${g.id} → ${g.seat}${g.id === inputId ? "（あなた）" : ""}</li>`).join("")}
    </ul>
  `;
  
}

function drawOverlay() {
  const ctx = seatCanvas.getContext("2d");
  ctx.clearRect(0, 0, seatCanvas.width, seatCanvas.height);

  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        let x = segment.x;
        let y = segment.y - segment.dy * i;

        // 通常表示（ズームなし）を想定
        const size = 35; // 等倍描画。CSSで拡大するならここはそのままでOK

        ctx.beginPath();

        if (label === mySeat) {
          ctx.shadowBlur = 15;
          ctx.shadowColor = "rgba(255, 0, 0, 0.8)";
          ctx.strokeStyle = "rgba(242, 255, 0, 0.6)";
          ctx.lineWidth = 4;
          ctx.strokeRect(x - size / 2, y - size / 2, size, size);
        } else {
          ctx.shadowBlur = 0;
          ctx.shadowColor = "transparent";
        }

        ctx.fillStyle = groupSeats.includes(label)
          ? "rgba(100, 200, 255, 0.3)"
          : (label === mySeat ? "rgba(190, 70, 255, 0.3)" : "rgba(22, 22, 62, 0)");

        ctx.fillRect(x - size / 2, y - size / 2, size, size);
      }
    }
  }
}
