const homeScreen = document.getElementById("homeScreen");
const viewerScreen = document.getElementById("viewerScreen");
const attentionScreen = document.getElementById("attentionScreen");

const noticeScreen = document.getElementById("noticeScreen");
const consentModal = document.getElementById("consentModal");

window.addEventListener("resize", () => {
  redrawAll(); // これで描き直すだけにする
});

function goToViewer() {
  showScreenWithGlitch('viewerScreen');
  blackout.style.pointerEvents = 'auto';
  blackout.style.opacity = 1;
  setTimeout(() => {
    document.getElementById('homeScreen').style.display = 'none';

    
    document.getElementById('viewerScreen').style.display = 'block';
    blackout.style.opacity = 0;
    blackout.style.pointerEvents = 'none';
  }, 500);

  homeScreen.classList.add("hidden");
  viewerScreen.classList.remove("hidden");
  

  image.src = "seatmap.jpg";
  
  setTimeout(() => {
    fullImageLoaded = true;
    minimap.width = 300;
    minimap.height = image.height / image.width * minimap.width;
    drawSeats();
  }, 500);
}



function goHome() {
  window.location.href = "indextrue.html";
}

const blackout = document.getElementById('blackout');
function showScreenWithGlitch(screenId) {
  const blackout = document.getElementById('blackout');
  const glitch = document.getElementById('glitch');

  // グリッチ発動
  glitch.style.opacity = 1;
  glitch.style.animation = 'glitchEffect 0.6s ease-in-out';

  setTimeout(() => {
    blackout.style.opacity = 1;
  }, 300);

  setTimeout(() => {
    // ここで画面切り替え！！
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    document.getElementById(screenId).classList.remove('hidden');

    // blackoutとglitchをリセット
    glitch.style.opacity = 0;
    glitch.style.animation = 'none';
    blackout.style.opacity = 0;
  }, 800);
}



const canvas = document.getElementById("seatCanvas");
const ctx = canvas.getContext("2d");
const minimap = document.getElementById("minimap");
const mctx = minimap.getContext("2d");
const output = document.getElementById("output");
const image = new Image();


const zoomSize = 650;
const zoomScale = 0.55;

const ax = 1200
const seatData = {
"A": [
  { "start": 5, "count": 3, "y": 1961, "dy": 45.4, "x": 1130.0 },
  { "start": 8, "count": 9, "y": 1730, "dy": 45.4, "x": 1130.0 },
  { "start": 19, "count": 9, "y": 1232, "dy": 45.4, "x": 1130.0 },
  { "start": 28, "count": 3, "y": 749, "dy": 45.4, "x": 1130.0 }
],
"B": [
  { "start": 5, "count": 3, "y": 1961, "dy": 45.4, "x": 1181.9 },
  { "start": 8, "count": 10, "y": 1753, "dy": 45.4, "x": 1181.9 },
  { "start": 19, "count": 9, "y": 1251, "dy": 45.4, "x": 1181.9 },
  { "start": 28, "count": 3, "y": 749, "dy": 45.4, "x": 1181.9 }
],
"C": [
  { "start": 4, "count": 4, "y": 2008, "dy": 45.4, "x": 1233.8 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1233.8 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1233.8 }
],
"D": [
  { "start": 4, "count": 4, "y": 2006, "dy": 45.4, "x": 1285.7 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1285.7 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1285.7 }
],
"E": [
  { "start": 4, "count": 4, "y": 2007, "dy": 45.4, "x": 1337.6 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1337.6 },
  { "start": 28, "count": 4, "y": 749, "dy": 45.4, "x": 1337.6 }
],
"F": [
  { "start": 3, "count": 5, "y": 2051, "dy": 45.4, "x": 1389.5 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1389.5 },
  { "start": 28, "count": 5, "y": 749, "dy": 45.4, "x": 1389.5 }
],
"G": [
  { "start": 3, "count": 5, "y": 2053, "dy": 45.4, "x": 1441.4 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1441.4 },
  { "start": 28, "count": 5, "y": 749, "dy": 45.4, "x": 1441.4 }
],
"H": [
  { "start": 2, "count": 6, "y": 2099, "dy": 45.4, "x": 1493.3 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1493.3 },
  { "start": 28, "count": 6, "y": 749, "dy": 45.4, "x": 1493.3 }
],
"I": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1545.2 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1545.2 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1545.2 }
],
"J": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1597.1 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1597.1 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1597.1 }
],
"K": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1649.0 },
  { "start": 8, "count": 20, "y": 1730, "dy": 45.4, "x": 1649.0 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1649.0 }
],
"L": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1700.9 },
  { "start": 8, "count": 20, "y": 1753, "dy": 45.4, "x": 1700.9 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1700.9 }
],

  "M": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1752.8 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1752.8 }
],
"N": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1804.7 },
  
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1804.7 }
],
"O": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1856.6 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 1856.6 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 1856.6 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1856.6 }
],
"P": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1908.5 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 1908.5 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 1908.5 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1908.5 }
],
"Q": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 1960.4 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 1960.4 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 1960.4 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 1960.4 }
],
"R": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2012.3 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 2012.3 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 2012.3 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2012.3 }
],
"S": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2064.2 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 2064.2 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 2064.2 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2064.2 }
],
"T": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2116.1 },
  { "start": 8, "count": 6, "y": 1790, "dy": 45.4, "x": 2116.1 },
  { "start": 22, "count": 6, "y": 1056, "dy": 45.4, "x": 2116.1 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2116.1 }
],
"U": [
  { "start": 1, "count": 7, "y": 2143, "dy": 45.4, "x": 2168 },
  { "start": 8, "count": 6, "y": 1768, "dy": 45.4, "x": 2168 },
  { "start": 22, "count": 6, "y": 1079, "dy": 45.4, "x": 2168 },
  { "start": 28, "count": 7, "y": 749, "dy": 45.4, "x": 2168 }
],
"V": [
  { "start": 1, "count": 7, "x": 2278.4, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2278.4, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2278.4, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2278.4, "y": 749,  "dy": 45.4 }
],
"W": [
  { "start": 1, "count": 7, "x": 2330.3, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2330.3, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2330.3, "y": 749,  "dy": 45.4 }
],
"X": [
  { "start": 1, "count": 7, "x": 2382.2, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2382.2, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2382.2, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2382.2, "y": 749,  "dy": 45.4 }
],
"Y": [
  { "start": 1, "count": 7, "x": 2434.1, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2434.1, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2434.1, "y": 749,  "dy": 45.4 }
],
"Z": [
  { "start": 1, "count": 7, "x": 2486.0, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2486, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2486, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2486.0, "y": 749,  "dy": 45.4 }
],
"AA": [
  { "start": 1, "count": 7, "x": 2537.9, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2537.9, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2537.9, "y": 749,  "dy": 45.4 }
],
"AB": [
  { "start": 1, "count": 7, "x": 2589.8, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2589.8, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2589.8, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2589.8, "y": 749,  "dy": 45.4 }
],
"AC": [
  { "start": 1, "count": 7, "x": 2641.7, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2641.7, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2641.7, "y": 749,  "dy": 45.4 }
],
"AD": [
  { "start": 1, "count": 7, "x": 2693.6, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2693.6, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2693.6, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2693.6, "y": 749,  "dy": 45.4 }
],
"AC": [
  { "start": 1, "count": 7, "x": 2641.7, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2641.7, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2641.7, "y": 749,  "dy": 45.4 }
],
"AD": [
  { "start": 1, "count": 7, "x": 2693.6, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 10, "x": 2693.6, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 9, "x": 2693.6, "y": 1229, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2693.6, "y": 749,  "dy": 45.4 }
],
"AE": [
  { "start": 1, "count": 7, "x": 2745.5, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 20, "x": 2745.5, "y": 1753, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2745.5, "y": 749,  "dy": 45.4 }
],
"AF": [
  { "start": 1, "count": 7, "x": 2797.4, "y": 2143, "dy": 45.4 },
  { "start": 8, "count": 5, "x": 2797.4, "y": 1730, "dy": 45.4 },
  { "start": 19, "count": 7, "x": 2797.4, "y": 1138.2, "dy": 45.4 },
  { "start": 28, "count": 7, "x": 2797.4, "y": 749,  "dy": 45.4 }
]

};


const studentToSeat = {
"3637": "O08",
"3508": "O09",
"3629": "O10",
"3409": "O11",
"3301": "O12",
"3904": "X19",
"3915": "X20",
"3916": "X21",
"3927": "X22",
"3905": "X23",
"1308": "S22",
"1326": "S23",
"1327": "S24",
"1304": "S25",
"1341": "S26",
"1815": "H08",
"1821": "H09",
"1804": "H10",
"1816": "H11",
"1822": "H12",
"2839": "Z01",
"2833": "Z02",
"2830": "Z03",
"2805": "Z04",
"2803": "Z05",
"2620": "W08",
"2618": "W09",
"2628": "W10",
"2629": "W11",
"2625": "W12",
"2909": "R01",
"2926": "R02",
"2915": "R03",
"2902": "R04",
"2910": "R05",
"1831": "L28",
"1838": "L29",
"1833": "L30",
"1834": "L31",
"1840": "L32",
"1322": "K01",
"1309": "K02",
"1303": "K03",
"1310": "K04",
"1330": "K05",
"2338": "T28",
"2312": "T29",
"2317": "T30",
"2321": "T31",
"2306": "T32",
"1932": "M28",
"1933": "M29",
"1934": "M30",
"1927": "M31",
"1926": "M32",
"3713": "T22",
"3724": "T23",
"3838": "T24",
"3723": "T25",
"3727": "T26",
"3122": "Y08",
"3110": "Y09",
"3112": "Y10",
"3222": "Y11",
"3230": "Y12",
"1618": "AC28",
"1617": "AC29",
"1616": "AC30",
"1613": "AC31",
"1635": "AC32",
"2213": "P28",
"2205": "P29",
"2234": "P30",
"2206": "P31",
"2220": "P32",
"1522": "G28",
"1524": "G29",
"1506": "G30",
"1517": "G31",
"1528": "G32",
"1108": "T01",
"1124": "T02",
"1123": "T03",
"1106": "T04",
"1122": "T05",
"1521": "AA28",
"1516": "AA29",
"1530": "AA30",
"1529": "AA31",
"1539": "AA32",
"1628": "V01",
"1622": "V02",
"1623": "V03",
"1630": "V04",
"1631": "V05",
"1614": "D08",
"1608": "D09",
"1605": "D10",
"1606": "D11",
"1611": "D12",
"1139": "V28",
"1137": "V29",
"1135": "V30",
"1136": "V31",
"1138": "V32",
"1918": "J01",
"1910": "J02",
"1917": "J03",
"1902": "J04",
"1904": "J05",
"2336": "Y13",
"2126": "Y14",
"2226": "Y15",
"2709": "Y16",
"2413": "Y17",
"2135": "AD19",
"2119": "AD20",
"2125": "AD21",
"2118": "AD22",
"2104": "AD23",
"2622": "AE01",
"2635": "AE02",
"2630": "AE03",
"2621": "AE04",
"2623": "AE05",
"3616": "F08",
"3618": "F09",
"3620": "F10",
"3622": "F11",
"3634": "F12",
"1105": "R28",
"1610": "R29",
"1612": "R30",
"1836": "R31",
"1835": "R32",
"2335": "N28",
"2901": "N29",
"2602": "N30",
"2102": "N31",
"2109": "N32",
"1940": "AC08",
"1909": "AC09",
"1911": "AC10",
"1913": "AC11",
"1916": "AC12",
"2738": "AA08",
"2331": "AA09",
"2535": "AA10",
"2528": "AA11",
"2340": "AA12",
"2405": "U08",
"2407": "U09",
"2417": "U10",
"2422": "U11",
"2434": "U12",
"2505": "Q08",
"2222": "Q09",
"2136": "Q10",
"2204": "Q11",
"2726": "Q12",
"1235": "L08",
"1718": "L09",
"1218": "L10",
"1221": "L11",
"1234": "L12",
"2412": "AF28",
"2624": "AF29",
"2720": "AF30",
"2721": "AF31",
"2129": "AF32",
"3309": "S01",
"3318": "S02",
"3331": "S03",
"3335": "S04",
"3310": "S05",
"1129": "O22",
"1127": "O23",
"1121": "O24",
"1128": "O25",
"1101": "O26",
"2707": "AC13",
"2714": "AC14",
"2727": "AC15",
"2729": "AC16",
"2730": "AC17",
"3311": "Q22",
"3330": "Q23",
"3421": "Q24",
"3714": "Q25",
"3715": "Q26",
"2626": "R22",
"2610": "R23",
"2613": "R24",
"2614": "R25",
"2627": "R26",
"3324": "O01",
"3316": "O02",
"3333": "O03",
"3334": "O04",
"3626": "O05",
"3428": "N01",
"3429": "N02",
"3418": "N03",
"3441": "N04",
"1226": "AD08",
"1220": "AD09",
"1224": "AD10",
"1222": "AD11",
"2235": "Y28",
"2223": "Y29",
"2232": "Y30",
"2236": "Y31",
"2937": "O28",
"2930": "O29",
"2925": "O30",
"2931": "O31",
"3419": "K28",
"3411": "K29",
"3438": "K30",
"3437": "K31",
"2813": "B19",
"2814": "B20",
"2831": "B21",
"2809": "B22",
"2924": "AF01",
"2916": "AF02",
"2917": "AF03",
"2919": "AF04",
"3902": "S08",
"3906": "S09",
"3914": "S10",
"3918": "S11",
"1826": "V19",
"1813": "V20",
"1812": "V21",
"1827": "V22",
"3738": "L01",
"3729": "L02",
"3726": "L03",
"3725": "L04",
"1239": "I01",
"1230": "I02",
"1229": "I03",
"1240": "I04",
"2802": "V23",
"2832": "V24",
"2825": "V25",
"2836": "V26",
"2311": "AA01",
"2314": "AA02",
"2323": "AA03",
"2332": "AA04",
"3202": "I08",
"3223": "I09",
"3131": "I10",
"3605": "I11",
"1901": "V08",
"1930": "V09",
"1936": "V10",
"1935": "V11",
"1715": "G08",
"1729": "G09",
"1730": "G10",
"1717": "G11",
"1213": "AD12",
"1233": "AD13",
"1525": "AD14",
"1134": "AD15",
"1637": "Y01",
"1625": "Y02",
"1634": "Y03",
"1615": "Y04",
"1723": "F13",
"1725": "F14",
"1720": "F15",
"1706": "F16",
"1640": "AB08",
"1627": "AB09",
"1633": "AB10",
"1636": "AB11",
"1728": "W01",
"1727": "W02",
"1712": "W03",
"1724": "W04",
"3721": "D04",
"3220": "D05",
"3212": "D06",
"3820": "D07",
"1120": "Q28",
"1115": "Q29",
"1125": "Q30",
"1130": "Q31",
"3735": "Z08",
"3535": "Z09",
"3306": "Z10",
"3708": "Z11",
"1739": "E04",
"1401": "E05",
"1219": "E06",
"1133": "E07",
"3730": "R08",
"3141": "R09",
"3439": "R10",
"3632": "R11",
"1708": "AF08",
"1701": "AF09",
"1703": "AF10",
"1704": "AF11",
"2301": "U01",
"2304": "U02",
"2305": "U03",
"2333": "U04",
"3113": "E28",
"3139": "E29",
"3704": "E30",
"3128": "E31",
"1914": "W13",
"1928": "W14",
"1938": "W15",
"1939": "W16",
"2824": "A08",
"2817": "A09",
"2504": "A10",
"2837": "A11",
"3105": "F28",
"3107": "F29",
"3114": "F30",
"3807": "F31",
"1810": "C08",
"1819": "C09",
"1811": "C10",
"1707": "C11",
"2229": "AE28",
"2835": "AE29",
"2327": "AE30",
"2230": "AE31",
"1132": "L13",
"1110": "L14",
"1109": "L15",
"1103": "L16",
"3539": "H02",
"3530": "H03",
"3529": "H04",
"3524": "H05",
"1201": "X24",
"1217": "X25",
"1223": "X26",
"1205": "X27",
"1113": "AB19",
"1102": "AB20",
"1334": "AB21",
"1335": "AB22",
"3504": "W28",
"3510": "W29",
"3612": "W30",
"3810": "W31",
"3217": "AB01",
"3502": "AB02",
"3432": "AB03",
"3937": "AB04",
"2408": "U28",
"2421": "U29",
"2436": "U30",
"2437": "U31",
"2606": "F03",
"2637": "F04",
"2705": "F05",
"2329": "F06",
"3135": "C12",
"3238": "C13",
"3315": "C14",
"3836": "C15",
"3213": "D28",
"3835": "D29",
"3520": "D30",
"3328": "D31",
"3130": "I28",
"3304": "I29",
"3308": "I30",
"3827": "I31",
"3627": "X28",
"3619": "X29",
"3537": "X30",
"3329": "X31",
"3430": "C16",
"3506": "C17",
"3601": "C18",
"3636": "C19",
"3702": "J28",
"3706": "J29",
"3705": "J30",
"3733": "J31",
"1520": "J08",
"1534": "J09",
"1503": "J10",
"1504": "J11",
"1321": "AD24",
"1317": "AD25",
"1318": "AD26",
"1315": "AD27",
"3111": "V12",
"3208": "V13",
"3312": "V14",
"3116": "V15",
"3829": "H28",
"3808": "H29",
"3822": "H30",
"3129": "H31",
"3138": "P08",
"3305": "P09",
"3435": "P10",
"3920": "P11",
"1738": "AC18",
"1726": "AC19",
"1732": "AC20",
"1736": "AC21",
"2737": "AB12",
"2719": "AB13",
"2233": "AB14",
"2224": "AB15",
"1419": "X01",
"1427": "X02",
"1424": "X03",
"1404": "X04",
"3340": "Y18",
"3317": "Y19",
"3321": "Y20",
"3326": "Y21",
"2736": "H13",
"2739": "H14",
"2728": "H15",
"2717": "H16",
"3538": "H17",
"3532": "H18",
"3234": "H19",
"3621": "H20",
"2117": "U22",
"2133": "U23",
"2121": "U24",
"2103": "U25",
"2426": "M01",
"2440": "M02",
"2404": "M03",
"2106": "M04",
"2140": "AB23",
"3720": "AB24",
"3240": "AB25",
"3509": "AB26",
"3313": "Z19",
"3123": "Z20",
"3828": "Z21",
"3501": "Z22",
"2507": "A19",
"2526": "A20",
"2522": "A21",
"2508": "A22",
"3607": "M05",
"3603": "M06",
"3617": "M07",
"3540": "I32",
"3522": "I33",
"3115": "I34",
"1232": "B28",
"1208": "B29",
"1237": "B30",
"3907": "C04",
"3926": "C05",
"3928": "C06",
"1206": "H21",
"1202": "H22",
"1238": "H23",
"2807": "I12",
"2804": "I13",
"2811": "I14",
"1440": "AB28",
"1434": "AB29",
"1433": "AB30",
"3609": "F17",
"3611": "F18",
"3628": "F19",
"2808": "AC01",
"2826": "AC02",
"2525": "AC03",
"1320": "K32",
"1313": "K33",
"1328": "K34",
"3624": "B08",
"3817": "B09",
"3215": "B10",
"1306": "AA05",
"1314": "AA06",
"1312": "AA07",
"3734": "AA13",
"3710": "AA14",
"3433": "AA15",
"1839": "F20",
"1829": "F21",
"1823": "F22",
"1832": "Q01",
"1828": "Q02",
"1825": "Q03",
"2904": "AD28",
"2911": "AD29",
"2914": "AD30",
"2908": "AF19",
"2912": "AF20",
"2934": "AF21",
"3709": "I05",
"3736": "I06",
"3739": "I07",
"1437": "Z12",
"1439": "Z13",
"1432": "Z14",
"2820": "AC04",
"2815": "AC05",
"2822": "AC06",
"1425": "B05",
"1431": "B06",
"1428": "B07",
"1502": "N05",
"1501": "N06",
"1509": "N07",
"1922": "AC22",
"1903": "AC23",
"1915": "AC24",
"1510": "L17",
"1511": "L18",
"1512": "L19",
"2302": "X05",
"2303": "X06",
"2309": "X07",
"1923": "H24",
"1919": "H25",
"1920": "H26",
"3434": "Z15",
"3424": "Z16",
"3403": "Z17",
"1515": "C28",
"1508": "C29",
"1514": "C30",
"2913": "Z23",
"2920": "Z24",
"2903": "Z25",
"2616": "U05",
"2415": "U06",
"2631": "U07",
"3231": "J32",
"3207": "J33",
"3225": "J34",
"2634": "L05",
"2723": "L06",
"2425": "L07",
"1907": "Z28",
"1905": "Z29",
"1908": "Z30",
"2731": "X08",
"2732": "X09",
"2722": "X10",
"3332": "P01",
"3336": "P02",
"3323": "P03",
"2319": "A05",
"2324": "A06",
"2617": "A07",
"1620": "W05",
"1602": "W06",
"1626": "W07",
"3801": "W32",
"3814": "W33",
"3821": "W34",
"2715": "I15",
"2733": "I16",
"2711": "I17",
"2701": "AF22",
"2704": "AF23",
"2716": "AF24",
"1114": "AB31",
"1126": "AB32",
"1118": "AB33",
"1111": "L20",
"1141": "L21",
"1104": "L22",
"1410": "G12",
"1407": "G13",
"1409": "G14",
"3216": "AD31",
"3604": "AD32",
"3201": "AD33",
"2438": "Z31",
"2402": "Z32",
"2122": "Z33",
"2401": "AB05",
"2420": "AB06",
"2435": "AB07",
"3712": "AC25",
"3929": "AC26",
"3633": "AC27",
"3802": "F23",
"3420": "F24",
"3513": "F25",
"3521": "P22",
"3718": "P23",
"3716": "P24",
"1533": "Q32",
"1415": "Q33",
"1236": "Q34",
"3815": "AE08",
"3519": "AE09",
"3833": "AE10",
"3402": "A23",
"3413": "A24",
"3426": "A25",
"1117": "AE32",
"1805": "AE33",
"1131": "AE34",
"2821": "Q04",
"2834": "Q05",
"2819": "Q06",
"1619": "B23",
"1609": "B24",
"1906": "B25",
"1214": "T08",
"1207": "T09",
"1203": "T10",
"2428": "W17",
"2221": "W18",
"2414": "W19",
"2532": "AE11",
"2202": "AE12",
"2315": "AE13",
"2530": "I18",
"2533": "I19",
"2511": "I20",
"1741": "J12",
"1737": "J13",
"1735": "J14",
"3237": "G03",
"3813": "G04",
"3233": "G05",
"2907": "AD01",
"2938": "AD02",
"2940": "AD03",
"3610": "Y05",
"3528": "Y06",
"3925": "Y07",
"1705": "J15",
"1719": "J16",
"1721": "J17",
"2120": "P25",
"2113": "P26",
"2105": "P27",
"2933": "W20",
"2906": "W21",
"2921": "W22",
"2928": "Y22",
"2929": "Y23",
"2519": "Y24",
"2423": "C20",
"2424": "C21",
"2431": "C22",
"3518": "AE14",
"3525": "AE15",
"3422": "AE16",
"1601": "AE17",
"1604": "AE18",
"1632": "AE19",
"2240": "AA16",
"2823": "AA17",
"2812": "AA18",
"3840": "AF05",
"3541": "AF06",
"3109": "AF07",
"3503": "L23",
"3516": "L24",
"3211": "L25",
"2515": "K08",
"2516": "K09",
"2806": "K10",
"3132": "S28",
"3134": "S29",
"3740": "S30",
"3625": "Y32",
"3635": "Y33",
"3511": "Y34",
"2816": "B11",
"2239": "B12",
"2702": "B13",
"3203": "AA19",
"3206": "AA20",
"3228": "AA21",
"2509": "E08",
"2108": "E09",
"2640": "E10",
"2110": "A12",
"2416": "A13",
"2608": "A14",
"2216": "T11",
"2207": "T12",
"2212": "T13",
"1430": "D13",
"1429": "D14",
"1422": "D15",
"2510": "W23",
"2429": "W24",
"2406": "W25",
"3935": "G06",
"3936": "G07",
"3901": "E11",
"3919": "E12",
"3826": "D16",
"3106": "D17",
"1302": "U32",
"1329": "U33",
"2827": "AD16",
"2840": "AD17",
"3436": "P33",
"3839": "P34",
"3303": "P04",
"3307": "P05",
"3417": "AE06",
"3404": "AE07",
"2918": "E13",
"2935": "E14",
"1311": "L33",
"1307": "L34",
"2433": "AA22",
"2219": "AA23",
"3923": "K11",
"3921": "K12",
"2603": "E15",
"2609": "E16",
"3737": "AA24",
"3805": "AA25",
"3423": "P06",
"3407": "P07",
"2611": "S06",
"2638": "S07",
"1814": "AA26",
"1817": "AA27",
"2607": "Y25",
"2601": "Y26",
"2615": "O06",
"2605": "O07",
"3405": "K13",
"3412": "K14",
"1709": "H06",
"1702": "H07",
"1411": "A28",
"1405": "A29",
"1438": "I21",
"1338": "I22",
"1531": "P12",
"1526": "P13",
"1305": "AF33",
"1412": "AF34",
"3124": "Z06",
"3127": "Z07",
"1507": "L26",
"1535": "L27",
"1324": "AC33",
"1435": "AC34",
"1818": "AA33",
"1837": "AA34",
"2203": "T33",
"2218": "T34",
"2521": "K06",
"2529": "K07",
"2712": "M33",
"2710": "M34",
"2310": "V16",
"2339": "V17",
"1921": "A26",
"1929": "A27",
"1332": "U26",
"1325": "U27",
"1519": "J06",
"1518": "J07",
"2724": "AD04",
"2537": "AD05",
"1333": "X11",
"1809": "X12",
"2713": "S31",
"2112": "S32",
"2123": "B26",
"2114": "B27",
"3701": "R12",
"3707": "R13",
"2210": "AE20",
"2215": "AE21",
"2735": "AB16",
"2734": "AB17",
"3703": "J18",
"3804": "J19",
"2538": "H32",
"2512": "H33",
"3338": "W26",
"3339": "W27",
"1408": "G15",
"1414": "G16",
"1402": "V06",
"1925": "V07",
"2116": "I23",
"2308": "I24",
"3320": "B14",
"3534": "B15",
"2619": "C23",
"2632": "C24",
"1204": "B16",
"1216": "B17",
"3732": "O32",
"3613": "O33",
"2636": "AE22",
"2237": "AE23",
"1323": "T06",
"1331": "T07",
"2124": "N33",
"2111": "N34",
"3406": "AD06",
"3232": "AD07",
"1209": "R33",
"1227": "R34",
"3830": "V33",
"3533": "V34",
"3823": "E17",
"3103": "E18",
"3831": "K15",
"3837": "K16",
"1337": "Z26",
"1319": "Z27",
"1420": "J20",
"1403": "J21",
"2101": "E19",
"3440": "E20",
"2801": "C25",
"2320": "C26",
"3415": "F26",
"3408": "F27",
"3908": "K17",
"3818": "K18",
"2540": "E21",
"2539": "E22",
"3416": "S33",
"3241": "S34",
"3229": "S12",
"3536": "S13",
"2708": "R06",
"2725": "R07",
"3214": "G17",
"3205": "G18",
"2534": "E23",
"2502": "E24",
"2211": "X13",
"2214": "X14",
"2107": "D18",
"2328": "D19",
"2427": "AE24",
"2432": "AE25",
"2334": "I25",
"2325": "I26",
"1713": "E25",
"1714": "E26",
"2128": "AE26",
"2127": "AE27",
"1436": "G19",
"1603": "G20",
"1225": "X15",
"1228": "X16",
"2536": "A15",
"2513": "A16",
"2411": "G21",
"2410": "G22",
"3507": "K19",
"3531": "K20",
"1807": "G23",
"1802": "G24",
"3218": "G25",
"3136": "G26",
"3909": "D20",
"3337": "D21",
"3121": "X32",
"3717": "X33",
"3133": "J22",
"3119": "J23",
"3401": "D22",
"3431": "D23",
"1426": "D24",
"1523": "D25",
"1421": "K21",
"1711": "K22",
"3204": "J24",
"3226": "J25",
"3314": "J26",
"3515": "J27",
"1722": "K23",
"1716": "K24",
"1423": "D26",
"1416": "D27",
"3322": "K25",
"3615": "K26",
"2818": "E27",
"2403": "C27",
"2130": "R27",
"1801": "V27",
"1527": "AD34",
"3731": "AF25",
"1830": "Y27",
"2337": "AF12",
"2231": "U13",
"1532": "Z34",
"2927": "S27",
"1808": "F07",
"2322": "O34",
"2217": "AB34",
"1731": "C31",
"1607": "Q27",
"1505": "G27",
"1211": "X34",
"1413": "Q07",
"2524": "I27",
"1210": "C07",
"1406": "O13",
"1301": "Q13",
"1621": "F32",
"3639": "AB27",
"1112": "O27",
"2520": "H27",
"1140": "T27",
"3425": "A30",
"2936": "K27",
"1116": "X17",
"1734": "U34",
"1536": "AC07"
};

const groups = [
  ['3428', '3429', '3418', '3441'] ,
  ['1226', '1220', '1224', '1222'] ,
  ['3607', '3603', '3617'] ,
  ['3904', '3915', '3916', '3927', '3905'] ,
  ['3540', '3522', '3115'] ,
  ['3935', '3936'] ,
  ['3901', '3919'] ,
  ['2235', '2223', '2232', '2236'] ,
  ['3826', '3106'] ,
  ['1232', '1208', '1237'] ,
  ['2937', '2930', '2925', '2931'] ,
  ['3419', '3411', '3438', '3437'] ,
  ['3907', '3926', '3928'] ,
  ['1206', '1202', '1238'] ,
  ['2807', '2804', '2811'] ,
  ['1440', '1434', '1433'] ,
  ['1302', '1329'] ,
  ['2827', '2840'] ,
  ['3436', '3839'] ,
  ['2818'] ,
  ['3303', '3307'] ,
  ['3609', '3611', '3628'] ,
  ['2403'] ,
  ['2808', '2826', '2525'] ,
  ['3417', '3404'] ,
  ['2918', '2935'] ,
  ['1320', '1313', '1328'] ,
  ['1311', '1307'] ,
  ['1308', '1326', '1327', '1304', '1341'] ,
  ['2813', '2814', '2831', '2809'] ,
  ['2924', '2916', '2917', '2919'] ,
  ['2433', '2219'] ,
  ['3923', '3921'] ,
  ['3624', '3817', '3215'] ,
  ['3902', '3906', '3914', '3918'] ,
  ['2603', '2609'] ,
  ['1306', '1314', '1312'] ,
  ['1826', '1813', '1812', '1827'] ,
  ['3734', '3710', '3433'] ,
  ['3738', '3729', '3726', '3725'] ,
  ['3737', '3805'] ,
  ['3423', '3407'] ,
  ['1839', '1829', '1823'] ,
  ['2611', '2638'] ,
  ['2130'] ,
  ['1832', '1828', '1825'] ,
  ['2904', '2911', '2914'] ,
  ['2908', '2912', '2934'] ,
  ['1815', '1821', '1804', '1816', '1822'] ,
  ['1239', '1230', '1229', '1240'] ,
  ['1814', '1817'] ,
  ['2607', '2601'] ,
  ['3709', '3736', '3739'] ,
  ['2802', '2832', '2825', '2836'] ,
  ['1437', '1439', '1432'] ,
  ['2615', '2605'] ,
  ['2820', '2815', '2822'] ,
  ['3405', '3412'] ,
  ['2839', '2833', '2830', '2805', '2803'] ,
  ['1801'] ,
  ['1709', '1702'] ,
  ['2620', '2618', '2628', '2629', '2625'] ,
  ['2311', '2314', '2323', '2332'] ,
  ['1411', '1405'] ,
  ['1527'] ,
  ['2909', '2926', '2915', '2902', '2910'] ,
  ['1425', '1431', '1428'] ,
  ['1438', '1338'] ,
  ['1531', '1526'] ,
  ['1502', '1501', '1509'] ,
  ['1305', '1412'] ,
  ['1922', '1903', '1915'] ,
  ['1510', '1511', '1512'] ,
  ['3124', '3127'] ,
  ['1507', '1535'] ,
  ['1831', '1838', '1833', '1834', '1840'] ,
  ['3202', '3223', '3131', '3605'] ,
  ['1324', '1435'] ,
  ['1901', '1930', '1936', '1935'] ,
  ['1322', '1309', '1303', '1310', '1330'] ,
  ['1715', '1729', '1730', '1717'] ,
  ['2338', '2312', '2317', '2321', '2306'] ,
  ['2302', '2303', '2309'] ,
  ['1818', '1837'] ,
  ['3731'] ,
  ['1923', '1919', '1920'] ,
  ['1213', '1233', '1525', '1134'] ,
  ['3434', '3424', '3403'] ,
  ['1830'] ,
  ['1932', '1933', '1934', '1927', '1926'] ,
  ['1515', '1508', '1514'] ,
  ['2337'] ,
  ['3713', '3724', '3838', '3723', '3727'] ,
  ['2203', '2218'] ,
  ['3122', '3110', '3112', '3222', '3230'] ,
  ['2913', '2920', '2903'] ,
  ['1637', '1625', '1634', '1615'] ,
  ['2616', '2415', '2631'] ,
  ['2521', '2529'] ,
  ['1723', '1725', '1720', '1706'] ,
  ['1618', '1617', '1616', '1613', '1635'] ,
  ['2712', '2710'] ,
  ['2310', '2339'] ,
  ['1640', '1627', '1633', '1636'] ,
  ['2213', '2205', '2234', '2206', '2220'] ,
  ['3231', '3207', '3225'] ,
  ['1728', '1727', '1712', '1724'] ,
  ['3721', '3220', '3212', '3820'] ,
  ['2634', '2723', '2425'] ,
  ['1921', '1929'] ,
  ['2231'] ,
  ['1332', '1325'] ,
  ['1519', '1518'] ,
  ['1532'] ,
  ['1120', '1115', '1125', '1130'] ,
  ['3735', '3535', '3306', '3708'] ,
  ['2724', '2537'] ,
  ['1522', '1524', '1506', '1517', '1528'] ,
  ['1108', '1124', '1123', '1106', '1122'] ,
  ['1333', '1809'] ,
  ['1521', '1516', '1530', '1529', '1539'] ,
  ['1907', '1905', '1908'] ,
  ['1739', '1401', '1219', '1133'] ,
  ['3730', '3141', '3439', '3632'] ,
  ['1708', '1701', '1703', '1704'] ,
  ['2713', '2112'] ,
  ['2927'] ,
  ['2301', '2304', '2305', '2333'] ,
  ['2123', '2114'] ,
  ['3701', '3707'] ,
  ['2731', '2732', '2722'] ,
  ['1628', '1622', '1623', '1630', '1631'] ,
  ['3332', '3336', '3323'] ,
  ['2319', '2324', '2617'] ,
  ['2210', '2215'] ,
  ['2735', '2734'] ,
  ['1614', '1608', '1605', '1606', '1611'] ,
  ['1620', '1602', '1626'] ,
  ['3703', '3804'] ,
  ['3113', '3139', '3704', '3128'] ,
  ['2538', '2512'] ,
  ['1914', '1928', '1938', '1939'] ,
  ['3801', '3814', '3821'] ,
  ['1139', '1137', '1135', '1136', '1138'] ,
  ['2824', '2817', '2504', '2837'] ,
  ['3105', '3107', '3114', '3807'] ,
  ['1810', '1819', '1811', '1707'] ,
  ['1918', '1910', '1917', '1902', '1904'] ,
  ['2715', '2733', '2711'] ,
  ['2701', '2704', '2716'] ,
  ['2229', '2835', '2327', '2230'] ,
  ['2336', '2126', '2226', '2709', '2413'] ,
  ['1114', '1126', '1118'] ,
  ['3338', '3339'] ,
  ['2135', '2119', '2125', '2118', '2104'] ,
  ['2622', '2635', '2630', '2621', '2623'] ,
  ['1132', '1110', '1109', '1103'] ,
  ['1111', '1141', '1104'] ,
  ['3539', '3530', '3529', '3524'] ,
  ['1410', '1407', '1409'] ,
  ['1408', '1414'] ,
  ['1201', '1217', '1223', '1205'] ,
  ['1113', '1102', '1334', '1335'] ,
  ['3504', '3510', '3612', '3810'] ,
  ['3616', '3618', '3620', '3622', '3634'] ,
  ['1402', '1925'] ,
  ['3216', '3604', '3201'] ,
  ['3217', '3502', '3432', '3937'] ,
  ['2116', '2308'] ,
  ['3320', '3534'] ,
  ['2619', '2632'] ,
  ['1204', '1216'] ,
  ['2438', '2402', '2122'] ,
  ['1105', '1610', '1612', '1836', '1835'] ,
  ['2408', '2421', '2436', '2437'] ,
  ['2401', '2420', '2435'] ,
  ['3732', '3613'] ,
  ['2636', '2237'] ,
  ['3712', '3929', '3633'] ,
  ['3802', '3420', '3513'] ,
  ['1323', '1331'] ,
  ['3508', '3629', '3637', '3409', '3301'] ,
  ['3521', '3718', '3716'] ,
  ['2606', '2637', '2705', '2329'] ,
  ['1533', '1415', '1236'] ,
  ['3135', '3238', '3315', '3836'] ,
  ['3213', '3835', '3520', '3328'] ,
  ['3815', '3519', '3833'] ,
  ['3402', '3413', '3426'] ,
  ['2124', '2111'] ,
  ['1117', '1805', '1131'] ,
  ['3130', '3304', '3308', '3827'] ,
  ['3406', '3232'] ,
  ['1209', '1227'] ,
  ['3830', '3533'] ,
  ['2821', '2834', '2819'] ,
  ['1808'] ,
  ['3627', '3619', '3537', '3329'] ,
  ['1619', '1609', '1906'] ,
  ['2335', '2901', '2602', '2102', '2109'] ,
  ['3823', '3103'] ,
  ['3831', '3837'] ,
  ['3430', '3506', '3601', '3636'] ,
  ['1940', '1909', '1911', '1913', '1916'] ,
  ['1214', '1207', '1203'] ,
  ['2322'] ,
  ['2428', '2221', '2414'] ,
  ['2738', '2331', '2535', '2528', '2340'] ,
  ['2532', '2202', '2315'] ,
  ['3702', '3706', '3705', '3733'] ,
  ['1520', '1534', '1503', '1504'] ,
  ['2405', '2407', '2417', '2422', '2434'] ,
  ['1337', '1319'] ,
  ['1420', '1403'] ,
  ['2530', '2533', '2511'] ,
  ['2101', '3440'] ,
  ['2505', '2222', '2136', '2204', '2726'] ,
  ['1741', '1737', '1735'] ,
  ['3237', '3813', '3233'] ,
  ['2217'] ,
  ['1731'] ,
  ['2907', '2938', '2940'] ,
  ['2801', '2320'] ,
  ['3610', '3528', '3925'] ,
  ['1235', '1718', '1218', '1221', '1234'] ,
  ['1321', '1317', '1318', '1315'] ,
  ['1607'] ,
  ['3415', '3408'] ,
  ['1505'] ,
  ['3111', '3208', '3312', '3116'] ,
  ['3829', '3808', '3822', '3129'] ,
  ['3138', '3305', '3435', '3920'] ,
  ['3908', '3818'] ,
  ['1705', '1719', '1721'] ,
  ['1738', '1726', '1732', '1736'] ,
  ['1211'] ,
  ['2412', '2624', '2720', '2721', '2129'] ,
  ['1413'] ,
  ['2540', '2539'] ,
  ['2737', '2719', '2233', '2224'] ,
  ['3416', '3241'] ,
  ['3309', '3318', '3331', '3335', '3310'] ,
  ['3229', '3536'] ,
  ['1129', '1127', '1121', '1128', '1101'] ,
  ['2524'] ,
  ['1419', '1427', '1424', '1404'] ,
  ['2120', '2113', '2105'] ,
  ['2933', '2906', '2921'] ,
  ['2707', '2714', '2727', '2729', '2730'] ,
  ['3340', '3317', '3321', '3326'] ,
  ['2708', '2725'] ,
  ['2928', '2929', '2519'] ,
  ['1210'] ,
  ['3214', '3205'] ,
  ['2534', '2502'] ,
  ['2736', '2739', '2728', '2717'] ,
  ['2211', '2214'] ,
  ['2423', '2424', '2431'] ,
  ['2107', '2328'] ,
  ['3518', '3525', '3422'] ,
  ['2427', '2432'] ,
  ['3538', '3532', '3234', '3621'] ,
  ['1601', '1604', '1632'] ,
  ['2240', '2823', '2812'] ,
  ['2334', '2325'] ,
  ['1713', '1714'] ,
  ['2128', '2127'] ,
  ['1436', '1603'] ,
  ['1225', '1228'] ,
  ['2117', '2133', '2121', '2103'] ,
  ['2536', '2513'] ,
  ['1406'] ,
  ['3840', '3541', '3109'] ,
  ['2411', '2410'] ,
  ['3503', '3516', '3211'] ,
  ['2426', '2440', '2404', '2106'] ,
  ['3507', '3531'] ,
  ['1807', '1802'] ,
  ['2140', '3720', '3240', '3509'] ,
  ['3218', '3136'] ,
  ['2515', '2516', '2806'] ,
  ['3132', '3134', '3740'] ,
  ['3313', '3123', '3828', '3501'] ,
  ['3625', '3635', '3511'] ,
  ['2816', '2239', '2702'] ,
  ['3909', '3337'] ,
  ['3203', '3206', '3228'] ,
  ['2509', '2108', '2640'] ,
  ['2110', '2416', '2608'] ,
  ['2216', '2207', '2212'] ,
  ['1301'] ,
  ['3121', '3717'] ,
  ['1621'] ,
  ['1430', '1429', '1422'] ,
  ['3133', '3119'] ,
  ['2510', '2429', '2406'] ,
  ['3639'] ,
  ['3401', '3431'] ,
  ['1112'] ,
  ['3311', '3330', '3421', '3714', '3715'] ,
  ['2520'] ,
  ['1426', '1523'] ,
  ['1140'] ,
  ['1421', '1711'] ,
  ['2507', '2526', '2522', '2508'] ,
  ['3204', '3226'] ,
  ['2626', '2610', '2613', '2614', '2627'] ,
  ['3425'] ,
  ['3314', '3515'] ,
  ['2936'] ,
  ['3324', '3316', '3333', '3334', '3626'] ,
  ['1722', '1716'] ,
  ['1423', '1416'] ,
  ['1116'] ,
  ['1734'] ,
  ['1536'] ,
  ['3322', '3615']
];

let highlightBox = null;
let zoomedIn = true;
let fullImageLoaded = false;
let currentSeat = null;
let currentGroup = [];



minimap.addEventListener("click", () => {
  zoomedIn = !zoomedIn;
  drawSeats(currentSeat, currentGroup);
});

function drawSeats(mySeat = null, groupSeats = []) {
  if (!fullImageLoaded) return;

  let highlight = null;
  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        if (label === mySeat) {
          highlight = { x: segment.x, y: segment.y - segment.dy * i };
        }
      }
    }
  }

  highlightBox = highlight;
  const ratio = window.devicePixelRatio || 1; // 追加: ディスプレイ解像度
  
  const scale = (zoomedIn && highlightBox) ? zoomScale : 1;

  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  


  if (zoomedIn && highlightBox) {
    const sx = Math.max(0, highlightBox.x - zoomSize / 2);
    const sy = Math.max(0, highlightBox.y - zoomSize / 2);
  
    // キャンバスの内部サイズをratio倍
    canvas.width = zoomSize * zoomScale * ratio;
    canvas.height = zoomSize * zoomScale * ratio;
  
    // CSSの見た目サイズは変えない
    canvas.style.width = (zoomSize * zoomScale) + "px";
    canvas.style.height = (zoomSize * zoomScale) + "px";
  
    // スケール調整
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  
    ctx.drawImage(
      image,
      sx, sy, zoomSize, zoomSize, // 元画像から切り取る部分
      0, 0, zoomSize * zoomScale, zoomSize * zoomScale // キャンバスに描くサイズ
    );
    
    
  } else {
    
   const baseW = image.naturalWidth;
  const baseH = image.naturalHeight;


// スマホ画面の幅に合わせて表示サイズを決める
const maxDisplayWidth = canvas.parentElement.clientWidth || window.innerWidth;
const scale = maxDisplayWidth / baseW;

// CSSの見た目サイズ（ディスプレイ用）
canvas.style.width = (baseW * scale) + "px";
canvas.style.height = (baseH * scale) + "px";

// 内部ピクセルサイズを ratio 倍
canvas.width = baseW * ratio;
canvas.height = baseH * ratio;

// 高DPI対応で拡大描画
ctx.setTransform(ratio, 0, 0, ratio, 0, 0);

// 画像描画（切り出しなし）
ctx.imageSmoothingEnabled = false;
ctx.drawImage(
  image,
  0, 0, baseW, baseH,  // 元画像の全体を
  0, 0, baseW, baseH   // キャンバスにも等倍で描画
);

    

  } 
  
  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        let x = segment.x;
        let y = segment.y - segment.dy * i;

        if (zoomedIn && highlightBox) {
          x = (x - highlightBox.x + zoomSize / 2) * zoomScale;
          y = (y - highlightBox.y + zoomSize / 2) * zoomScale;
        }

        ctx.beginPath();
        const size = 35 * scale; // 直径と同じサイズ

        if (label === mySeat) {
            ctx.shadowBlur = 15;
            ctx.shadowColor = "rgba(255, 0, 0, 0.8)";
            ctx.strokeStyle = "rgb(242, 255, 0, 0.6)";
            ctx.lineWidth = 4;
            ctx.strokeRect(x - size/2, y - size/2, size, size);
          } else {
            ctx.shadowBlur = 0;
            ctx.shadowColor = "transparent";
        }

        ctx.fillStyle = groupSeats.includes(label) 
        ? "rgba(100, 200, 255, 0.3)"
        : (label === mySeat ? "rgba(190, 70, 255, 0.3)" : "rgba(255, 255, 255, 0.2)");

        ctx.fillRect(x - size/2, y - size/2, size, size);
      }
    }
  }

  const s = minimap.width / image.width;
  mctx.clearRect(0, 0, minimap.width, minimap.height);
  mctx.drawImage(image, 0, 0, minimap.width, minimap.height);
  if (highlightBox) {
    mctx.strokeStyle = "red";
    mctx.lineWidth = 1;
    mctx.strokeRect(
      (highlightBox.x - zoomSize / 2) * s,
      (highlightBox.y - zoomSize / 2) * s,
      zoomSize * s,
      zoomSize * s
    );
  }
}

function highlightGroup() {
  const inputId = document.getElementById("studentId").value.trim();
  const mySeat = studentToSeat[inputId];
  if (!mySeat) {
    currentSeat = null;
    currentGroup = [];
    output.innerHTML = "<strong>エラー:</strong> HRNOが登録されていません。";
    drawSeats();
    return;
  }

  zoomedIn = true;
  const myGroup = groups.find(g => g.includes(inputId)) || [];
  const groupInfo = myGroup.map(id => ({ id, seat: studentToSeat[id] || "-" }));

  currentSeat = mySeat;
  currentGroup = groupInfo.map(g => g.seat).filter(s => s !== mySeat);

  drawSeats(currentSeat, currentGroup);

  groupInfo.sort((a, b) => {
    const [aCol, aRow] = [a.seat[0], parseInt(a.seat.slice(1))];
    const [bCol, bRow] = [b.seat[0], parseInt(b.seat.slice(1))];
  
    if (aCol !== bCol) return bCol.localeCompare(aCol); // 列を逆順
    return bRow - aRow; // 数字を逆順
  });
  
  output.innerHTML = `
    <strong>あなたの席:</strong> ${mySeat}<br>
    <strong>グループメンバーの席:</strong><br>
    <ul>
      ${groupInfo.map(g => `<li>${g.id} → ${g.seat}${g.id === inputId ? "（あなた）" : ""}</li>`).join("")}
    </ul>
  `;
  
}

function drawOverlay() {
  const ctx = seatCanvas.getContext("2d");
  ctx.clearRect(0, 0, seatCanvas.width, seatCanvas.height);

  for (const col in seatData) {
    for (const segment of seatData[col]) {
      for (let i = 0; i < segment.count; i++) {
        const seatNum = segment.start + i;
        const label = `${col}${String(seatNum).padStart(2, '0')}`;
        let x = segment.x;
        let y = segment.y - segment.dy * i;

        // 通常表示（ズームなし）を想定
        const size = 35; // 等倍描画。CSSで拡大するならここはそのままでOK

        ctx.beginPath();

        if (label === mySeat) {
          ctx.shadowBlur = 15;
          ctx.shadowColor = "rgba(255, 0, 0, 0.8)";
          ctx.strokeStyle = "rgba(242, 255, 0, 0.6)";
          ctx.lineWidth = 4;
          ctx.strokeRect(x - size / 2, y - size / 2, size, size);
        } else {
          ctx.shadowBlur = 0;
          ctx.shadowColor = "transparent";
        }

        ctx.fillStyle = groupSeats.includes(label)
          ? "rgba(100, 200, 255, 0.3)"
          : (label === mySeat ? "rgba(190, 70, 255, 0.3)" : "rgba(22, 22, 62, 0)");

        ctx.fillRect(x - size / 2, y - size / 2, size, size);
      }
    }
  }
}
